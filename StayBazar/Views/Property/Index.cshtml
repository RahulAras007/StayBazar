@model StayBazar.Models.PropertyModel
@using Microsoft.AspNet.Identity
@{
    string email = User.Identity.GetUserName();
    int roleId = BLayer.User.GetRole(email);
    ViewBag.Title = "Index";
    int nosAdults = 0, nosChildren = 0;
    int maxGuests;
    int.TryParse(Model.Filter.Adults, out nosAdults);
    int.TryParse(Model.Filter.Children, out nosChildren);
    bool itemRemoved = true;
    int AssistedBookingFlag = BLayer.User.GetAssistedBookingFlag(email);
    string userid = User.Identity.GetUserId();
    long MyAssistedBookingCount = BLayer.User.GetCountofMyAssistedBooker(userid);
    while (itemRemoved)
    {
        itemRemoved = false; //stop flag
        foreach (CLayer.Accommodation ac in Model.Accommodations.Accommodations)
        {
            if (ac.AccommodationCount == 0)
            {
                Model.Accommodations.Accommodations.Remove(ac);
                itemRemoved = true;//found unwanted item
                break;
            }
        }
    }
    //for (int i = 0; i < Model.Accommodations.Accommodations.Count;i++ )
    //{
    //    if (Model.Accommodations.Accommodations[i].AccommodationCount == 0)
    //    { Model.Accommodations.Accommodations.Remove(Model.Accommodations.Accommodations[i]); }
    //}
    long firstacc = 0;
    List<CLayer.Condition> conditions;
    List<CLayer.Offers> offrs;
    bool showOffer = (Model.UserType != CLayer.Role.Roles.Corporate && Model.UserType != CLayer.Role.Roles.CorporateUser);
    if (showOffer)
    {
        offrs = BLayer.Offers.GetForPropertyCalc(Model.PropertyId, Model.Filter.HiddenCheckIn, Model.Filter.HiddenCheckOut);
    }
    else
    { offrs = new List<CLayer.Offers>(); }
    double avgDailyRate = 0;
    int noOfDays = (Model.Filter.HiddenCheckOut - Model.Filter.HiddenCheckIn).Days;
    string no_image = System.Configuration.ConfigurationManager.AppSettings.Get("NoImageLnk");

    if (Model.Accommodations.Accommodations.Count > 0)
    {
        List<CLayer.Accommodation> accs = Model.Accommodations.Accommodations.OrderBy(m => m.Rate).ToList();
        Model.Accommodations.Accommodations = accs;
    }
    //show Checktime
    long PropertyId = Model.PropertyId;
    CLayer.Property dttime = BLayer.Property.GetCheckTime(PropertyId);

    if (dttime != null)
    {

        if (dttime.MetaDescription != null && dttime.MetaDescription != "")
        {
            ViewBag.MetaDescription = dttime.MetaDescription;
        }
        //else
        //{
        //    ViewBag.MetaDescription = "Experience the best hospitality, service and convenience at " + Model.Title + "Serviced apartments in " + Model.Location + " , " + Model.City;
        //}


        if (dttime.PageTitle != null && dttime.PageTitle != "")
        {
            ViewBag.Title = dttime.PageTitle;
        }
        else
        {
            //ViewBag.Title = Model.Title + " | " + "Serviced apt in " + Model.Location + ", " + Model.City + " - Staybazar";
            ViewBag.Title = Model.Title;
        }
    }

    ViewBag.PId = Model.PropertyId;

    //set mindate
    int allowmindate = 1;
    if (User.IsInRole("Administrator"))
    {
        allowmindate = 0;
    }

    //set mindate  forcorporate
    long useridd = Convert.ToInt32(User.Identity.GetUserId());
    if (useridd > 0)
    {
        CLayer.Role.Roles urole = BLayer.User.GetRole(useridd);
        if (urole == CLayer.Role.Roles.Corporate)
        {
            DateTime Credirbookingsmedayexp = BLayer.B2B.GetbookingsmedayforCorp(useridd);
            if (Credirbookingsmedayexp < DateTime.Now)
            {
                allowmindate = 1;
            }
            else
            {
                allowmindate = 0;
            }
        }
    }
    if (Model.CameFromSearchPage)
    {
        ViewBag.BreadCrumb = " <p style='margin-top: -29px; margin-left: 38px;'> > </p>  <div style='margin-top: -30px; margin-left: 50px;' itemscope itemtype='http://data-vocabulary.org/Breadcrumb'> <a href='#' itemprop='url' class=\"backtosearch whitetext breadhvr\" ><span class=\" whitetext breadhvr\"  itemprop=\"title\">Search</span></a>  </div> <p style='margin-top: -19px; margin-left: 94px;'> > </p> <div style='margin-top: -30px; margin-left: 107px;' itemscope itemtype=\"http://data-vocabulary.org/Breadcrumb\"><span class=\" whitetext breadhvr\"  itemprop=\"title\">Property</span></div>";

    }
    else
    {
        ViewBag.BreadCrumb = " <p style='margin-top: -29px; margin-left: 38px;'> > </p>  <div id='breads' style='margin-top: -30px; margin-left: 50px;'> <div itemscope itemtype='http://data-vocabulary.org/Breadcrumb'> <a href=''  itemprop='url'  class=' whitetext breadhvr' > <span class=' whitetext breadhvr'  itemprop='title'>Property</span></a>  </div> </div>";
    }
}

<!--fsdfsdfsdfsfsdfsdfsdfsdf-->
@{
    List<CLayer.Currency> currencies = BLayer.Currency.GetForListing();
    System.Text.StringBuilder curcodes = new System.Text.StringBuilder();
    System.Text.StringBuilder curarray = new System.Text.StringBuilder();
    foreach (CLayer.Currency item in currencies)
    {
        curcodes.Append(",");
        curcodes.Append(item.Title);

        curarray.Append("['");
        curarray.Append(item.Title);
        curarray.Append("','");
        curarray.Append(item.Symbol);
        curarray.Append("','");
        curarray.Append(item.ConversionRate);
        curarray.Append("'],");
    }
    if (curarray.Length > 0)
    {
        curarray.Remove(curarray.Length - 1, 1);
    }
    string defaultCurCode = "";
    if (Request.Cookies.Get("CurCode") != null)
    { defaultCurCode = Request.Cookies.Get("CurCode").Value; }
    string fname = "";
    bool IsForStaticPage = false;
    if (ViewBag.IsForStaticPage != null)
    { IsForStaticPage = (bool)ViewBag.IsForStaticPage; }

}

@{
    string extensions = System.Configuration.ConfigurationManager.AppSettings.Get("NonImageDocumentFileTypes");
    string[] allowedFileExtensions = extensions.Split(',');
}


<link href="~/Content/jquery.dpNumberPicker-holoLight-1.0.1.css" rel="stylesheet" />
<script src="~/Scripts/jquery.dpNumberPicker-1.0.1.js" type="text/javascript"></script>
<script src="~/Scripts/bootstrap-formhelpers.js" type="text/javascript"></script>
<script src="~/Scripts/default.js" type="text/javascript"></script>
<script src="~/Scripts/placeholder.js" type="text/javascript"></script>



<!--fsdfsdfsdfsfsdfsdfsdfsdf-->





@if (roleId == 6 || roleId == 1|| roleId == 5)
{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}


<link rel="stylesheet" href="~/RahulSample/css/bootstrap.min.css">
<link rel="stylesheet" href="~/RahulSample/css/font-awesome.min.css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="~/RahulSample/css/animate.min.css">

<!-- Current Page Styles -->
<link rel="stylesheet" type="text/css" href="~/RahulSample/components/revolution_slider/css/settings.css" media="screen" />
<link rel="stylesheet" type="text/css" href="~/RahulSample/components/revolution_slider/css/style.css" media="screen" />
<link rel="stylesheet" type="text/css" href="~/RahulSample/components/jquery.bxslider/jquery.bxslider.css" media="screen" />
<link rel="stylesheet" type="text/css" href="~/RahulSample/components/flexslider/flexslider.css" media="screen" />

<!-- Main Style -->
<link id="main-style" rel="stylesheet" href="~/RahulSample/css/style.css">

<!-- Updated Styles -->
<link rel="stylesheet" href="~/RahulSample/css/updates.css">

<!-- Custom Styles -->
<link rel="stylesheet" href="~/RahulSample/css/custom.css">

<!-- Responsive Styles -->
<link rel="stylesheet" href="~/RahulSample/css/responsive.css">
<!-- Send Query popup -->
@Html.Partial("~/Views/Property/SendQuery.cshtml")
<!-- Send Query popup -->
<!-- Parallax section -->

@{
    int carouselIndex = 0;
    bool imagesFound = false;
}
@try
{
    <div id="page-wrapper">
        <div class="page-title-container">
            <div class="container">
                <div class="page-title pull-left">
                    <h2 class="entry-title">Hotel @Model.Title Detailed</h2>
                </div>
            </div>
        </div>

        <section id="content">
            <div class="container">
                <div class="row">

                </div>
            </div>
            <br />
            <div class="container">

                <div class="row">

                    <div id="main" class="col-md-8">

                        <div class="tab-container style1" id="hotel-main-content">

                            <div class="tab-content" id="slider">

                                <div id="photos-tab" class="tab-pane fade in active">
                                    <div class="photo-gallery style1" data-animation="slide" data-sync="#photos-tab .image-carousel">
                                        <ul class="slides">
                                            <li><img src="~/RahulSample/HotelImages/HotelImages900-500/16232.jpg" /></li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-1103808.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-164595.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-262047.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-277572.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-941861.jpeg" />
                                            </li>
                                            <li><img src="~/RahulSample/HotelImages/HotelImages900-500/16232.jpg" /></li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-1103808.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-164595.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-262047.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-277572.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages900-500/pexels-photo-941861.jpeg" />
                                            </li>
                                        </ul>

                                    </div>
                                    <div class="image-carousel style1" data-animation="slide" data-item-width="70" data-item-margin="10" data-sync="#photos-tab .photo-gallery">
                                        <ul class="slides">
                                            <li><img src="~/RahulSample/HotelImages/HotelImages70-70/16232.jpg" /></li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-1103808.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-164595.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-262047.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-277572.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-941861.jpeg" />
                                            </li>
                                            <li><img src="~/RahulSample/HotelImages/HotelImages70-70/16232.jpg" /></li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-1103808.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-164595.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-262047.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-277572.jpeg" />
                                            </li>
                                            <li>
                                                <img src="~/RahulSample/HotelImages/HotelImages70-70/pexels-photo-941861.jpeg" />
                                            </li>
                                        </ul>
                                    </div>
                                </div>



                            </div>
                        </div>

                        <div id="hotel-features" class="tab-container">
                            <ul class="tabs">
                                <li class="active"><a href="#hotel-description" data-toggle="tab">Description</a></li>
                                <li><a href="#hotel-availability" data-toggle="tab">Availability</a></li>
                                <li><a href="#hotel-amenities" data-toggle="tab">Amenities</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="hotel-description">
                                    <div class="long-description">
                                        <h2>@Model.Title</h2>
                                        <p>
                                            <small>@Html.Raw(Model.Description)</small>
                                        </p>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="hotel-availability">
                                    <h2>Available Rooms</h2>
                                    <div class="room-list listing-style3 hotel">
                                        @if (Model.Accommodations.Accommodations.Count > 0)
                                        {
                                            if (firstacc == 0) { firstacc = Model.Accommodations.Accommodations[0].AccommodationId; }
                                            foreach (CLayer.Accommodation ac in Model.Accommodations.Accommodations)
                                            {
                                                maxGuests = ac.MaxNoOfPeople;
                                                if (maxGuests < 0) { maxGuests = 0; }
                                                if (showOffer)
                                                {
                                                    offrs = BLayer.Offers.GetForAccommodationCalc(ac.AccommodationId, Model.Filter.HiddenCheckIn, Model.Filter.HiddenCheckOut);
                                                    if (offrs.Count > 0)
                                                    {
                                                        CLayer.Offers offr = offrs[0];
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <p>
                                                                    <h4>OFFER: @offr.OfferTitle</h4>
                                                                    <div>The offer is valid for the accommodation below. Expires on @(offr.EndDate.ToShortDateString())</div>
                                                                </p>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                avgDailyRate = Math.Round((double)ac.Rate / noOfDays);

                                                <table class="room-options fullwidth">
                                                    <tbody>
                                                        <tr>
                                                            <td class="wdt280">
                                                                <div class="col-md-4 room-thumb">
                                                                    @{
                                                                        CLayer.AccommodationFiles file = BLayer.AccommodationFiles.GetSingleOnAccommodation(ac.AccommodationId);
                                                                        if (file != null)
                                                                        {
                                                                            if (File.Exists(Server.MapPath("~/Files/Property/Accommodation/" + ac.AccommodationId + "/" + file.FileName)))
                                                                            {
                                                                                <a href="#" onclick="gallery(@ac.AccommodationId)">
                                                                                    <img src="~/Files/Property/Accommodation/@ac.AccommodationId/@file.FileName" title="@StayBazar.Common.Utils.GetImageAlt(ac.AccommodationType)" alt="@StayBazar.Common.Utils.GetImageAlt(ac.AccommodationType)" />
                                                                                </a>
                                                                            }
                                                                            else
                                                                            {
                                                                                <div class="alert alert-warning" onclick="gallery(@ac.AccommodationId)">No image</div>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <div class="alert alert-warning" onclick="gallery(@ac.AccommodationId)">No image</div>
                                                                        }
                                                                    }
                                                                </div>
                                                                <div class="col-md-8">
                                                                    <h4>@ac.AccommodationType</h4>

                                                                    @{
                                                                        List<CLayer.AccommodationFeature> features = BLayer.AccommodationFeature.GetAllWithSelectedForAccommodation(ac.AccommodationId);
                                                                        foreach (CLayer.AccommodationFeature af in features)
                                                                        {
                                                                            if (af.IsUsed)
                                                                            {
                                                                                <div class="accdtn-icon @if (af.Style != "") { <text>@af.Style</text>  }"><label data-toggle="tooltip" title="@af.Title"></label></div>
                                                                            }
                                                                        }
                                                                    }
                                                                </div>
                                                            </td>
                                                            <td class="wdt80">
                                                                <header>Max</header>
                                                                <div class="cell_fill_maxcol">
                                                                    <p>
                                                                        @if (ac.MinNoOfPeople < 4)
                                                                        {
                                                                            for (int ii = 0; ii < ac.MinNoOfPeople; ii++)
                                                                            {
                                                                                <span class="fa fa-male max_adult_size"></span>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <text>@ac.MinNoOfPeople X <span class="fa fa-male max_adult_size"></span></text>
                                                                        }
                                                                    </p>
                                                                    <p>
                                                                        @if (ac.MaxNoOfChildren < 4)
                                                                        {
                                                                            for (int ii = 0; ii < ac.MaxNoOfChildren; ii++)
                                                                            {
                                                                                <span class="fa fa-male max_child_size"></span>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <text>@ac.MaxNoOfChildren X <span class="fa fa-male max_child_size"></span></text>
                                                                        }
                                                                    </p>
                                                                    <p><a class="maxpinfo" href="#" data-toggle="popover" data-html="true" data-content="These are adults/children limits exceeding which additional guest charges will be applied "><span class="glyphicon glyphicon-info-sign"></span></a></p>
                                                                </div>
                                                            </td>
                                                            <td class="wdt80">
                                                                <header>People</header>
                                                                <div class="table-cell">

                                                                    <p>
                                                                        <div style="width:100px;">Adults</div>
                                                                        <input type="hidden" id="@(ac.AccommodationId)_rate" class="cxcurinput" value="@Math.Round(ac.Rate)" />
                                                                        <input type="hidden" id="@(ac.AccommodationId)_grate" class="cxcurinput" value="@Math.Round(ac.GuestRate)" />
                                                                        <input type="hidden" id="@(ac.AccommodationId)_maxgt" value="@maxGuests" />
                                                                        <input type="hidden" id="@(ac.AccommodationId)_maxad" value="@ac.MinNoOfPeople" />
                                                                        <input type="hidden" id="@(ac.AccommodationId)_maxch" value="@ac.MaxNoOfChildren" />
                                                                        <input type="hidden" id="@(ac.AccommodationId)_total" value="0" />
                                                                        <select class="fullwidth bkpeople" id="@(ac.AccommodationId)_adults">
                                                                            @if (nosAdults > maxGuests)
                                                                            {
                                                                                <option selected value="0">0</option>
                                                                                for (int i = 1; i <= ac.MaxNoOfPeople; i++)
                                                                                {
                                                                                    <option value="@i">@i</option>
                                                                                }
                                                                            }
                                                                            else
                                                                            {

                                                                                for (int i = 1; i <= maxGuests; i++)
                                                                                {
                                                                                    <option @if (i == nosAdults) { <text> selected </text> } value="@i">@i</option>
                                                                                }
                                                                            }
                                                                        </select>
                                                                        <div>Children</div>
                                                                        <select class="fullwidth bkpeople" id="@(ac.AccommodationId)_kids">
                                                                            @if (nosChildren > maxGuests)
                                                                            {
                                                                                <option selected value="0">0</option>
                                                                                for (int i = 1; i <= ac.MaxNoOfChildren; i++)
                                                                                {
                                                                                    <option value="@i">@i</option>
                                                                                }
                                                                            }
                                                                            else
                                                                            {
                                                                                for (int i = 0; i <= maxGuests; i++)
                                                                                {
                                                                                    <option @if (i == nosChildren) { <text> selected </text> } value="@i">@i</option>
                                                                                }
                                                                            }
                                                                        </select>
                                                                        <input type="hidden" value="0" id="@(ac.AccommodationId)_guests" />


                                                                    </p>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <header>Avg Daily Rate</header>
                                                                <div class="table-cell rightalign">
                                                                    <div class="fa cxprice fa-rupee" style="font-size: 23px;"><span class="cxcurele" style="font-size: 23px;">@avgDailyRate</span></div>
                                                                </div>
                                                            </td>
                                                            <td class="wdt140">
                                                                <header>No. Accommodations</header>
                                                                <div class="table-cell">
                                                                    <select class="fullwidth bkacc" id="@(ac.AccommodationId)_noaccomm">
                                                                        @if (ac.AccommodationCount != null && ac.AccommodationCount != 0)
                                                                        {
                                                                            <option selected value="0">0</option>

                                                                            for (int i = 1; i <= ac.AccommodationCount; i++)
                                                                            {
                                                                                <option value="@i">@i</option>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value="0">0</option>
                                                                        }
                                                                    </select>

                                                                </div>
                                                                <div class="table-cell">
                                                                    <div style="margin-top:15px;">Price</div>
                                                                    <div class="fa cxprice fa-rupee" style="font-size: 23px;"><span style="font-size: 23px;" id="@(ac.AccommodationId)_showr">@ac.Rate</span></div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        @{
                                                            conditions = Model.AccConditions.Where(m => m.AccommodationId == ac.AccommodationId).ToList();
                                                        }
                                                        @if (conditions.Count > 0)
                                                        {
                                                            <tr>
                                                                <td colspan="5">
                                                                    <header>Conditions</header>
                                                                    <div class="cell_fill">
                                                                        @{
                                                                            <ul>
                                                                                @foreach (CLayer.Condition item in conditions)
                                                                                {
                                                                                    <li>@item.ConditionText</li>
                                                                                }
                                                                            </ul>
                                                                        }
                                                                    </div>
                                                                </td>
                                                            </tr>
}
                                                        <tr>
                                                            <td class="room-note lightgreybg padding10px" colspan="5">
                                                                <div>Prices are per accommodation</div>
                                                                <div>

                                                                    <b>Taxes extra as applicable&nbsp;</b>
                                                                </div>
                                                            </td>

                                                        </tr>
                                                    </tbody>
                                                </table>
                                            }
                                        }
                                        else
                                        {
                                            <div class="row ">
                                                <div class="col-md-8 col-md-offset-2">
                                                    <div class="alert alert-info"> Stay options are not available in date range and options you have selected. Please select alternate date range or options to proceed.</div>
                                                </div>
                                            </div>

                                        }
                                    </div>

                                </div>
                                <div class="tab-pane fade" id="hotel-amenities">
                                    <h2>Amenities</h2>

                                    <ul class="amenities clearfix style1">
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-wifi"></i>WI_FI</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-swimming"></i>swimming pool</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-television"></i>television</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-coffee"></i>coffee</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-aircon"></i>air conditioning</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-fitnessfacility"></i>fitness facility</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-fridge"></i>fridge</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-winebar"></i>wine bar</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-smoking"></i>smoking allowed</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-entertainment"></i>entertainment</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-securevault"></i>secure vault</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-pickanddrop"></i>pick and drop</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-phone"></i>room service</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-pets"></i>pets allowed</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-playplace"></i>play place</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-breakfast"></i>complimentary breakfast</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-parking"></i>Free parking</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-conference"></i>conference room</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-fireplace"></i>fire place</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-handicapaccessiable"></i>Handicap Accessible</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-doorman"></i>Doorman</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-tub"></i>Hot Tub</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-elevator"></i>Elevator in Building</div>
                                        </li>
                                        <li class="col-md-4 col-sm-6">
                                            <div class="icon-box style1"><i class="soap-icon-star"></i>Suitable for Events</div>
                                        </li>
                                    </ul>
                                    <br />


                                </div>

                            </div>
                        </div>


                    </div>




                    <div class="sidebar col-md-4">
                        <article class="detailed-logo">
                            @if ((Model.Accommodations.Accommodations.Count > 0) || (ViewBag.AmedusRoomsList > 0))
                            {
                                <form method="post" action="@Url.Action("Book", "booking")" id="BookAccommodation">
                                    <figure>
                                        <div class="row" style="padding-left:10px;">
                                            <div class="col-md-12">
                                                <table>
                                                    <tr>
                                                        <td>
                                                            <label>Booking For : </label>
                                                        </td>
                                                        <td style="padding-left:20px;">
                                                            @Html.RadioButtonFor(m => m.BookingForSelf, "S", new { id = "R1", @checked = true, @onchange = "SetVisible(0);" })<span>Self</span>
                                                        </td>
                                                        <td style="padding-left:20px;">
                                                            @if (AssistedBookingFlag == 1 || MyAssistedBookingCount > 0)
                                                            {
                                                                @Html.RadioButtonFor(m => m.BookingForSelf, "A", new { id = "R2", onchange = "SetVisible(1);" })<span>Others (Assisted)</span>
                                                            }
                                                        </td>
                                                        <td>
                                                            <div id="dddv" style="display:none">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding-left:10px;">
                                                            <div id="D2" style="display:none">
                                                                @if (MyAssistedBookingCount > 0)
                                                                {
                                                                    @Html.DropDownListFor(m => m.AssistedCorporateUserID, Model.MyAssistedUsers, "-Select-", new { @class = "form-control" })

                                                                }
                                                                else
                                                                {
                                                                    @Html.DropDownListFor(m => m.AssistedCorporateUserID, Model.CorporateUserName_ForCorporateUsers, "-Select-", new { @class = "form-control" })

                                                                }
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        <br />
                                        <br />
                                        <div class="row" style="padding-left:10px;">
                                            <div class="col-md-12">

                                                <table>
                                                    <tr>
                                                        <td>
                                                            <label>Billing For : </label>
                                                        </td>
                                                        <td style="padding-left:20px;">
                                                            @Html.RadioButtonFor(m => m.NewBillingFor, "P", new { id = "R3" })<span>Personal</span>
                                                        </td>
                                                        <td style="padding-left:20px;">
                                                            @Html.RadioButtonFor(m => m.NewBillingFor, "B", new { id = "R4", @checked = true })<span>Company/Business</span>
                                                        </td>
                                                    </tr>
                                                </table>

                                                <script language="javascript">
                                                    function SetVisible(obj) {
                                                        var value = obj;
                                                        document.getElementById("dddv").style.display = "none"
                                                        document.getElementById("D2").style.display = "none"
                                                        if (value == 0) {
                                                            document.getElementById("dddv").style.display = "none";
                                                            document.getElementById("R4").checked = true;
                                                        }
                                                        if (value == 1) {
                                                            document.getElementById("D2").style.display = "block";
                                                            document.getElementById("R4").checked = true;
                                                        }

                                                    }
                                                </script>
                                            </div>
                                        </div>
                                    </figure>
                                    <div class="details">
                                        <h2 class="box-title">@Model.Title<small><i class="soap-icon-departure yellow-color"></i><span class="fourty-space">@Model.Location</span></small></h2>
                                        <span class="price clearfix">
                                            <small class="pull-left">avg/night</small>
                                            <span class="pull-right" id="BookingTotal">&#8377;00</span>
                                        </span>
                                        <div class="update-search clearfix">
                                            <div id="loading" class="loader" style="display:none;">
                                                <div class="center_load">
                                                    <img src="~/images/loading.gif" width="30" height="30" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <input type="hidden" id="BookingData" name="BookingData" />
                                                <input type="hidden" id="PropertyId" name="PropertyId" value="@Model.PropertyId" />
                                                <input type="hidden" id="BookCheckIn" name="BookCheckIn" value="@Model.Filter.HiddenCheckIn" />
                                                <input type="hidden" id="BookCheckOut" name="BookCheckOut" value="@Model.Filter.HiddenCheckOut" />
                                                <button id="property_booknow" onclick="bookAccommodation()" type="button" data-animation-duration="1" data-animation-type="bounce" class="full-width icon-check animated">BOOK NOW</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            }
                        </article>
                        <div class="travelo-box contact-box">
                            <div class="update-search clearfix">
                                <div>
                                    <div class="hidden">
                                        @using (Html.BeginForm("revise", "property", FormMethod.Post, new { id = "bsearchform", onsubmit = "return validDates()" }))
                                        {
                                            <input type="hidden" value="@Model.Filter.PropertyId" id="PropertyId" name="PropertyId" />
                                            <input type="hidden" value="@Model.Filter.Destination" id="Destination" name="Destination" />
                                            <input type="hidden" value="@Model.Filter.Adults" id="Adults" name="Adults" />
                                            <input type="hidden" value="@Model.Filter.Children" id="Children" name="Children" />
                                            <input type="hidden" value="@Model.Filter.Bedrooms" id="Bedrooms" name="Bedrooms" />
                                            <input type="hidden" value="@Model.Filter.StayType" id="StayType" name="StayType" />
                                            <input type="hidden" value="@Model.Filter.CheckIn" id="CheckIn" name="CheckIn" />
                                            <input type="hidden" value="@Model.Filter.CheckOut" id="CheckOut" name="CheckOut" />
                                            <input type="hidden" value="@Model.Filter.HidAdults" id="HidAdults" name="HidAdults" />
                                            <input type="hidden" value="@Model.Filter.HidBedrooms" id="HidBedrooms" name="HidBedrooms" />
                                            <input type="hidden" value="@Model.Filter.HiddenCheckIn" id="HiddenCheckIn" name="HiddenCheckIn" />
                                            <input type="hidden" value="@Model.Filter.HiddenCheckOut" id="HiddenCheckOut" name="HiddenCheckOut" />
                                            <input type="hidden" value="@Model.Filter.HidChildren" id="HidChildren" name="HidChildren" />
                                            <input type="hidden" value="@Model.Filter.CurrentPage" id="CurrentPage" name="CurrentPage" />
                                            <input type="hidden" value="@Model.Filter.HiddenDestination" id="HiddenDestination" name="HiddenDestination" />
                                            <input type="hidden" value="@Model.Filter.Location" id="Location" name="Location" />
                                            <input type="hidden" value="@Model.Filter.distanceInKm" id="distanceInKm" name="distanceInKm" />
                                            <input type="hidden" value="@Model.Filter.features" id="features" name="features" />

                                            <input type="hidden" value="@Model.Filter.rangeBudgetMin" id="rangeBudgetMin" name="rangeBudgetMin" />
                                            <input type="hidden" value="@Model.Filter.rangeBudgetMax" id="rangeBudgetMax" name="rangeBudgetMax" />
                                            <input type="hidden" value="@Model.Filter.HidStayType" id="HidStayType" name="HidStayType" />
                                        }
                                    </div>
                                    <div class="row">
                                        <div>
                                            <label>CHECK IN</label>
                                            <div class="datepicker-wrap">
                                                <input type="text" readonly="readonly" id="start" @if (Model.Filter.HiddenCheckIn > DateTime.MinValue) { <text> value="@Model.Filter.HiddenCheckIn.ToShortDateString()" </text> } placeholder="mm/dd/yy" class="input-text full-width">
                                            </div>
                                        </div>
                                        <div>
                                            <label>CHECK OUT</label>
                                            <div class="datepicker-wrap">
                                                <input type="text" readonly="readonly" id="end" @if (Model.Filter.HiddenCheckOut > DateTime.MinValue) { <text> value="@Model.Filter.HiddenCheckOut.ToShortDateString()" </text> } placeholder="mm/dd/yy" class="input-text full-width">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    @*<h4 class="visible-md visible-lg">&nbsp;</h4>*@
                                    <label class="visible-md visible-lg">&nbsp;</label>
                                    <div class="row">
                                        If you need to book for different dates please use "Revise Dates" button
                                        <label class="visible-md visible-lg">&nbsp;</label>
                                        <div>
                                            <button data-animation-duration="1" data-animation-type="bounce" class="full-width icon-check animated" type="submit" id="confirmdatebutton" onclick="reviseDates()">Confirm dates</button>
                                        </div>
                                    </div>
                                    <label class="visible-md visible-lg">&nbsp;</label>
                                    <div class="row">
                                        <div>
                                            <button data-animation-duration="1" data-animation-type="bounce" class="full-width icon-check animated" type="submit" id="revisedatebuttton">Revise dates</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="travelo-box contact-box">
                            @{
                                string UserIds = User.Identity.GetUserId();
                                CLayer.Role.Roles UsertypeId = BLayer.User.GetRole(Convert.ToInt32(UserIds));
                                decimal Partialamountperc = 0;
                                if (UsertypeId == CLayer.Role.Roles.Customer || UsertypeId == CLayer.Role.Roles.Administrator)
                                {
                                    Partialamountperc = Math.Round(BLayer.Property.GetPropertyB2CpartialamountPerc(Model.PropertyId));

                                }
                                if (UsertypeId == CLayer.Role.Roles.Corporate || UsertypeId == CLayer.Role.Roles.Affiliate || UsertypeId == CLayer.Role.Roles.Supplier || UsertypeId == CLayer.Role.Roles.CorporateUser)
                                {
                                    Partialamountperc = Math.Round(BLayer.Property.GetPropertyB2BpartialamountPerc(Model.PropertyId));

                                }
                            }
                            @if (Partialamountperc > 0)
                            {

                                <h4>Partial/Full Payment Options available</h4>

                            }
                            <label class="visible-md visible-lg">&nbsp;</label>
                            <button data-animation-duration="1" data-animation-type="bounce" class="full-width icon-check animated" type="button" onclick="SendQuery()">Enquire Now</button>
                        </div>
                        @*<div class="travelo-box">
                        <h4>Similar Listings</h4>
                        <div class="image-box style14">
                            <article class="box">
                                <figure>
                                    <a href="#"><img src="http://placehold.it/63x59" alt="" /></a>
                                </figure>
                                <div class="details">
                                    <h5 class="box-title"><a href="#">Plaza Tour Eiffel</a></h5>
                                    <label class="price-wrapper">
                                        <span class="price-per-unit">$170</span>avg/night
                                    </label>
                                </div>
                            </article>
                            <article class="box">
                                <figure>
                                    <a href="#"><img src="http://placehold.it/63x59" alt="" /></a>
                                </figure>
                                <div class="details">
                                    <h5 class="box-title"><a href="#">Sultan Gardens</a></h5>
                                    <label class="price-wrapper">
                                        <span class="price-per-unit">$620</span>avg/night
                                    </label>
                                </div>
                            </article>
                            <article class="box">
                                <figure>
                                    <a href="#"><img src="http://placehold.it/63x59" alt="" /></a>
                                </figure>
                                <div class="details">
                                    <h5 class="box-title"><a href="#">Park Central</a></h5>
                                    <label class="price-wrapper">
                                        <span class="price-per-unit">$322</span>avg/night
                                    </label>
                                </div>
                            </article>
                        </div>
                    </div>*@
                        <div class="travelo-box book-with-us-box">
                            <h4>Why Book with us?</h4>
                            <ul>
                                <li>
                                    <i class="soap-icon-hotel-1 circle"></i>
                                    <h5 class="title"><a href="#">135,00+ Hotels</a></h5>
                                    @*<p></p>*@
                                </li>
                                <li>
                                    <i class="soap-icon-savings circle"></i>
                                    <h5 class="title"><a href="#">Low Rates &amp; Savings</a></h5>
                                    @*<p>Nunc cursus libero pur congue arut nimspnty.</p>*@
                                </li>
                                <li>
                                    <i class="soap-icon-support circle"></i>
                                    <h5 class="title"><a href="#">Excellent Support</a></h5>
                                    @*<p>Nunc cursus libero pur congue arut nimspnty.</p>*@
                                </li>
                            </ul>
                        </div>
                        <div id="Bookingavailablecheckalert" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg" style="width:34%;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4 class="modal-title">Not available</h4>
                                    </div>
                                    <div id="maximojo" class="modal-body">
                                        <h5 class="redtext" id="alertfrombookcheck"> </h5>
                                    </div>
                                    <div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Ok</button></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            @Html.Partial("~/Views/Widget/_SearchMostPopular.cshtml")
            <div>
                @Html.Partial("~/Views/Search/GetPreferdHotels.cshtml")
            </div>
        </section>
    </div>




    <!-- Javascript -->
    <script type="text/javascript" src="~/RahulSample/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="~/RahulSample/js/jquery.noconflict.js"></script>
    <script type="text/javascript" src="~/RahulSample/js/modernizr.2.7.1.min.js"></script>
    <script type="text/javascript" src="~/RahulSample/js/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="~/RahulSample/js/jquery.placeholder.js"></script>
    <script type="text/javascript" src="~/RahulSample/js/jquery-ui.1.10.4.min.js"></script>

    <!-- Twitter Bootstrap -->
    @*<script type="text/javascript" src="~/RahulSample/js/bootstrap.js"></script>*@

    <!-- load revolution slider scripts -->
    <script type="text/javascript" src="~/RahulSample/components/revolution_slider/js/jquery.themepunch.tools.min.js"></script>
    <script type="text/javascript" src="~/RahulSample/components/revolution_slider/js/jquery.themepunch.revolution.min.js"></script>

    <!-- load BXSlider scripts -->
    <script type="text/javascript" src="~/RahulSample/components/jquery.bxslider/jquery.bxslider.min.js"></script>

    <!-- load FlexSlider scripts -->
    <script type="text/javascript" src="~/RahulSample/components/flexslider/jquery.flexslider-min.js"></script>

    <!-- Google Map Api -->
    <script type='text/javascript' src="http://maps.google.com/maps/api/js?sensor=false&amp;language=en"></script>
    <script type="text/javascript" src="~/RahulSample/js/gmap3.min.js"></script>

    <!-- parallax -->
    <script type="text/javascript" src="~/RahulSample/js/jquery.stellar.min.js"></script>

    <!-- waypoint -->
    <script type="text/javascript" src="~/RahulSample/js/waypoints.min.js"></script>

    <!-- load page Javascript -->
    <script type="text/javascript" src="~/RahulSample/js/theme-scripts.js"></script>
    <script type="text/javascript" src="~/RahulSample/js/scripts.js"></script>

    <script type="text/javascript">
        tjq(document).ready(function () {
            tjq("#price-range").slider({
                range: true,
                min: 0,
                max: 1000,
                values: [100, 800],
                slide: function (event, ui) {
                    tjq(".min-price-label").html("$" + ui.values[0]);
                    tjq(".max-price-label").html("$" + ui.values[1]);
                }
            });
            tjq(".min-price-label").html("$" + tjq("#price-range").slider("values", 0));
            tjq(".max-price-label").html("$" + tjq("#price-range").slider("values", 1));

            tjq("#rating").slider({
                range: "min",
                value: 40,
                min: 0,
                max: 50,
                slide: function (event, ui) {

                }
            });
        });
    </script>

    <script type="text/javascript">
        function SendQuery() {
            $('#Sendquerypop').modal('show');
        }
    </script>
    <script type='text/javascript'>
        $(window).resize(function () {
            imgadj();
        });

        imgadj();

        function imgadj() {

            $(".img-thumb").each(function () {
                var refH = $(this).height();
                var refW = $(this).width();
                var refRatio = refW / refH;
                var imgH = $(this).children("img").height();
                var imgW = $(this).children("img").width();

                if ((imgW / imgH) < refRatio) {
                    $(this).addClass("portrait");
                } else {
                    $(this).addClass("landscape");
                }
            })
        }
    </script>
    <script type='text/javascript'>
        function MapApiLoaded() {

            // Latitude of google maps destination location
            var gmapsLatitude = @(Model.PositionLat);

            // Longitude of google maps destination location
            var gmapsLongitude = @(Model.PositionLng);

            // Enable the visual refresh
            google.maps.visualRefresh = true;

            var map, mapOptions = {
                zoom: 10,
                center: new google.maps.LatLng(gmapsLatitude, gmapsLongitude),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                scrollwheel: true
            };
            map = new google.maps.Map($('.map_canvas').get(0),
                mapOptions);

            new google.maps.Marker({
                position: new google.maps.LatLng(gmapsLatitude, gmapsLongitude),
                map: map
            });

        }
    </script>
    <script type='text/javascript'>
        for (i = 0; i <= $('.carousel-inner').children().length; i++) {
            $(".carousel-inner div:nth-child(" + i + ")").attr('data-slide-number', i);
            $("#slider-thumbs ul li:nth-child(" + i + ")").attr('id', 'carousel-selector-' + i + '');
        }

        $('#gallery').carousel({
            interval: 4000
        });

        function thumbactive() {
            var id = $('.item.active').data('slide-number');
            id = parseInt(id);
            $('[id^=carousel-selector-]').removeClass('selected');
            $('[id^=carousel-selector-' + id + ']').addClass('selected');
        }

        thumbactive(); //To initialize the active thumbnail

        // when the carousel slides, auto update
        $('#gallery').on('slid.bs.carousel', function (e) {
            thumbactive();
        });

        // handles the carousel thumbnails
        $('[id^=carousel-selector-]').click(function () {
            var id_selector = $(this).attr("id");
            var id = id_selector.substr(id_selector.length - 1);
            id = parseInt(id);
            $('#gallery').carousel(id - 1);
            $('[id^=carousel-selector-]').removeClass('selected');
            $(this).addClass('selected');
        });
    </script>
    <script type='text/javascript'>
        $('td .styleselect2').on('change', function () {
            $(this).parents("td").find(".person").remove();
            for (i = 0; i < $(this).val(); i++) {
                $(this).parents("td").find(".persons").append("<div class='person'></div>")
            }
        });
    </script>
    <script type="text/javascript">
        function gallery(id) {
            $.get('@(Url.Action("GetAccommodation", "Property"))?id=' + id, function (data) {
                if (data != null) {
                    $("#galleryData").html(data);
                    $("#accommodationGallery").modal('show');
                }
            });
        }
    </script>

    <script>

    function setCalendar()
    {

        var now = new Date();
        now.setDate(now.getDate() + 7);

        var checkin = $('#start').datepicker(
            {
                minDate:$("#hiddenmindate").val(),
                defaultDate: now,
                numberOfMonths: 2,
                dateFormat: "dd/mm/yy"
            });
        now.setDate(now.getDate() + 2);
        var checkout = $('#end').datepicker({
            minDate: 2,
            numberOfMonths: 2,
            defaultDate: now,
            dateFormat: "dd/mm/yy"
        });
    }
    $(function () {



        $("#start").change(function () {
            var v = $(this).val().trim();

            var curDate = new Date();
            curDate.setDate(curDate.getDate()+1);
            var idat = pad(curDate.getDate(), 2) + "/" + pad(parseInt(curDate.getMonth())+1, 2) + "/" + curDate.getFullYear();
            curDate.setDate(curDate.getDate()+ 2);
            var odat =  pad(curDate.getDate(), 2) + "/" + pad(parseInt(curDate.getMonth())+1, 2) + "/" + curDate.getFullYear();

            if (checkDate(v)) {
                re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
                if (regs = v.match(re)) {
                    var day,mnt,yr;
                    yr = parseInt(regs[3]);
                    mnt = parseInt(regs[2]);
                    dy =parseInt(regs[1]);
                    if(mnt>0) mnt = mnt - 1;
                    var cd = new Date(Date.UTC(yr,mnt,dy));
                    cd.setDate(cd.getDate()+2);
                    var mn = cd.getMonth() + 1; //parseInt(cd.getMonth()) + 1;
                    var chgDt = pad(cd.getDate(), 2) + "/" + pad(mn, 2) + "/" + cd.getFullYear();
                    // alert(chgDt);
                    var cs = new Date(Date.UTC(yr, mnt, dy));
                    var mind = new Date(Date.UTC(yr, mnt, dy));
                    mind.setDate(mind.getDate() + 1);
                    var mindx = pad(mind.getDate(), 2) + "/" + pad(parseInt(mind.getMonth())+1, 2) + "/" + mind.getFullYear();
                    var xo = $("#end").val();
                    //                    $("#CheckOut").datepicker("option", "minDate", mind);

                    if (checkDate(xo)) {
                        if (regss = xo.match(re)) {
                            yr = parseInt(regss[3]);
                            mnt = parseInt(regss[2]);
                            dy =parseInt(regss[1]);
                            if(mnt>0) mnt = mnt - 1;
                            var co = new Date(Date.UTC(yr, mnt, dy));
                            if (co <= cs) {
                                $("#end").val(chgDt);
                                // $("#CheckOut").datepicker("option", "setDate", cd);
                            }
                        }
                        else {
                            // $("#CheckOut").datepicker("option", "setDate", cd);
                            $("#end").val(chgDt);
                        }
                    }
                    else {
                        // $("#CheckOut").datepicker("option", "setDate", cd);
                        $("#end").val(chgDt);
                    }
                    //checkout.minDate = n;
                    $("#end").datepicker("option", "minDate", mindx);
                    //$("#CheckOut").datepicker("show");
                }
                else { $("#start").val(idat);$("#end").val(odat); }
            }
            else { $("#start").val(idat);$("#end").val(odat); }
        });


    });
    // disabling dates
    //  var nowTemp = new Date();
    //   var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);


        @*
                                    var checkin = $('#start').datepicker({
                                        dateFormat: "dd/mm/yy",
                                        onRender: function (date) {
                                            return date.valueOf() < now.valueOf() ? 'disabled' : '';
                                        }
                                    }).on('changeDate', function (ev) {
                                        if (ev.date.valueOf() > checkout.date.valueOf()) {
                                            var newDate = new Date(ev.date)
                                            newDate.setDate(newDate.getDate() + 1);
                                            checkout.setValue(newDate);
                                        }
                                        checkin.hide();
                                        $('#end')[0].focus();
                                    }).data('datepicker');
                                    var checkout = $('#end').datepicker({
                                        format: "dd/mm/yyyy",
                                        onRender: function (date) {
                                            return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
                                        }
                                    }).on('changeDate', function (ev) {
                                        checkout.hide();
                                    }).data('datepicker');
                                *@

    $(function(){
        $(".bkpeople").change(function(){

            var ids = $(this).attr("id");
            var aid = getId(ids);
            calcBkTotal(aid);
        });
        $(".bkacc").change(function(){
            var ids = $(this).attr("id");
            var aid = getId(ids);
            var elem = "#" + aid + "_";
            var rooms = $(elem + "noaccomm").val();
            if(rooms < 1) rooms =1;
            var gmax = $(elem+"maxgt").val();
            var gs = "";
            var cur = 0;
            mx = rooms* gmax;
            cur = $(elem+"adults").val();
            for(i=1;i<=mx;i++)
            {
                gs = gs + "<option value='" + i +"' ";
                if(i==0) gs= gs + " selected ";
                gs = gs + ">" + i +"</option>";
            }
            $(elem+"adults").html(gs);
            if(cur > mx){
                cur = $("#Adults").val();
            }
            $(elem+"adults").val(cur);
            gs="";
            mx = rooms* gmax;
            cur = $(elem+"kids").val();
            for(i=0;i<=mx;i++)
            {
                gs = gs + "<option value='" + i +"' ";
                if(i==0) gs= gs + " selected ";
                gs = gs + ">" + i +"</option>";
            }
            $(elem+"kids").html(gs);
            if(cur > mx){
                cur = $("#Children").val();
            }
            $(elem+"kids").val(cur);
            calcBkTotal(aid);
        });

        $(".bkacc").change();
        $(".backtosearch").click(function(){gotoSearch();});
            @*@if (firstacc>0){
        <text>
            $("#@(firstacc)_noaccomm").val(1);
            $(".bkacc").change();
            </text>
        }*@

    });
    function calcBkTotal(aid)
    {

        var elem = "#" + aid;

        var rooms = $(elem + "_noaccomm").val();
        if(rooms < 1) rooms =1;

        var rt = $(elem + "_rate").val();
        var grt = $(elem + "_grate").val();
        if(rt < 0) rt=0;
        if(grt < 0) grt = 0;
        var gmax = $(elem+"_maxgt").val();
        var pv = $(elem+"_adults").val();
        var px = $(elem+"_maxad").val();
        var guests =0;
        //  alert('adult pv px ' + pv + ' ' + px);
        px = px * rooms;
        if(pv > px) guests = guests + (pv-px);
        pv = $(elem+"_kids").val();
        px = $(elem+"_maxch").val();
        px = px * rooms;
        if(pv > px) guests = guests + (pv-px);
        //  alert('child pv px ' + pv + ' ' + px);
        // = $(elem + "_guests").val();
        $(elem + "_guests").val(guests);

        var total = (guests * grt) + (rooms * rt);
        $(elem + "_showr").html(htmlCurr(total));
        $(elem+"_total").val(total);
        var gtotal =0;
        $(".bkacc").each(function(){
            var id = getId($(this).attr("id"));
            if(parseInt($(this).val()) > 0)
            {
                gtotal = parseFloat(gtotal) + parseFloat($("#"+id+"_total").val());
            }
        });
        $("#BookingTotal").html(htmlCurr(gtotal));
        AddData(aid);
    }

    function htmlCurr(val)
    {
            @*  //var fv = parseFloat(val);
                                    //    var iv = parseInt(val);
                                    //    var sv = " " + fv;
                                    //    var idx = sv.indexOf(".");
                                    //    var len = sv.length;
                                    //    if(idx < 0)
                                    //        return sv ;

                                    //    if(len>= (idx + 3))
                                    //        sv = sv.substr(idx+1, 2);
                                    //    else{
                                    //        if(len >= (idx+2))
                                    //            sv = "" + sv.substr(idx+1, 1) + "0";
                                    //    }
                                    //    return "" + iv + "<small>" + sv + "</small>";       *@
        return Math.round(val) + "";
    }
    function getId(idname)
    {
        var idx = idname.indexOf("_");
        if(idx < 0) return "";
        return idname.substr(0,idx);
    }
    function AddData(aid)
    {
        debugger;
        var bd = $("#BookingData").val();
        var elem = "#" + aid + "_";
        if(bd != "")
        {
            var dt = bd.split("#");
            if(dt.length > 0)
            {
                var len = dt.length;
                var bt;
                var found = false;
                bd="";
                for(i=0;i<len;i++)
                {
                    bt = dt[i].split(",");
                    if(bt.length==5)
                    {
                        if(bt[0] == aid)
                        {
                            bd = bd + "#" + makeData(aid);
                            found=true;
                        }else
                        {
                            bd = bd +"#" + dt[i];
                        }
                    }
                }
                if(!found)
                {
                    bd = bd + "#" + makeData(aid);
                }
            }
        }
        else
        { bd = makeData(aid); }
            //alert(bd);
        $("#BookingData").val(bd);
    }
    function makeData(aid)
    {

        var elem = "#" + aid + "_";
        var guests = 0;
        var ad =$(elem +"adults").val();
        var ch = $(elem +"kids").val();
        var apx = $(elem +"maxad").val();
        var cpx = $(elem +"maxch").val();
        var rooms = $(elem + "noaccomm").val();
        apx = apx * rooms;
        cpx = cpx * rooms;
        if(ad > apx ) {guests = guests + (ad-apx); ad = apx;}
        if(ch > cpx ) {guests = guests + (ch-cpx); ch = cpx;}

        return ""+ aid + "," +  $(elem +"noaccomm").val() +","+ ad +","+ ch +","+ guests;
        }
        function testmakeData(aid) {

            var elem = "#" + aid + "_";
            var guests = 0;
            var ad = 2;
            var ch =1;
            var apx = 2;
            var cpx =4;
            var rooms = 2;
            apx = apx * rooms;
            cpx = cpx * rooms;
            if (ad > apx) { guests = guests + (ad - apx); ad = apx; }
            if (ch > cpx) { guests = guests + (ch - cpx); ch = cpx; }
            @*var PropertyId = @PropertyId;*@
            return "" + aid + "," + ad + "," + ad + "," + ch + "," + guests;
        }
    function gotoSearch()
    {
        var url = "/Search/Index" + "?Destination=" + $("#Destination").val() + "&CheckIn=" + $("#CheckIn").val() + "&CheckOut=" + $("#CheckOut").val() + "&Adults=" + $("#Adults").val() + "&Children=" + $("#Children").val() + "&BedRooms=" + $("#Bedrooms").val() + "&StayType=" + $("#StayType").val();
        window.location.href = url;
            @*frm = document.getElementById('bsearchform');
            //frm = $('#bsearchform');
            frm.action = '@Url.Action("Index","Search")';
            frm.submit();*@
    }
    function reviseDates()
    {
        $("#HiddenCheckIn").val($("#start").val());
        $("#HiddenCheckOut").val($("#end").val());

        var url = "/Property/Property?PropertyId=@PropertyId" + "&Destination=" + $("#Destination").val() + "&CheckIn=" + $("#HiddenCheckIn").val() + "&CheckOut=" + $("#HiddenCheckOut").val() + "&Adults=" + $("#Adults").val() + "&Children=" + $("#Children").val() + "&BedRooms=" + $("#Bedrooms").val() + "&StayType=" + $("#StayType").val();
        window.location.href = url;

            @*frm = document.getElementById('bsearchform');
            //frm = $('#bsearchform');
            frm.action = '@Url.Action("Property","Property")';
            frm.submit();*@
    }
    function bookAccommodation()
    {
        //alert("hi");
        //bd = testmakeData(20061);
        //$("#BookingData").val(bd);
                   
        //alert("myval " + BookingForSelfValue + " " + NewBillingForValue);

        if($("#BookingTotal").html() == "0")
        {
            $("#alertfrombookcheck").html('You need to make your accomodation selections in Availability section to proceed');
            $("#Bookingavailablecheckalert").modal('show');
            //return false;
        }
        else
        {
            document.getElementById('loading').style.display='block';

            var url = "@Url.Action("CheckAccommodationAvailable", "Property")";
             


            $.get(url, { PropertyId: @PropertyId, BookingData: $("#BookingData").val(), CheckIn: $("#BookCheckIn").val(), CheckOut: $("#BookCheckOut").val(), BookingForSelfValue: $('input:radio[name=BookingForSelf]:checked').val(), NewBillingForValue: $('input:radio[name=NewBillingFor]:checked').val()}, function (data) {


            @*$.get(url, { PropertyId: @PropertyId, BookingData: $("#BookingData").val(), BookCheckIn: $("#BookCheckIn").val(), BookCheckOut : $("#BookCheckOut").val()}, function (data) {*@
                debugger;

                document.getElementById('loading').style.display = 'none';

                if(data == "true")
                {

                    $("#BookAccommodation").submit();
                    $.cookie("BookingData",$("#BookingData").val(), { path: '/' });
                    $.cookie("BookCheckIn",$("#BookCheckIn").val(), { path: '/' });
                    $.cookie("BookCheckOut",$("#BookCheckOut").val(), { path: '/' });
                    $.cookie("NewBillingFor", $('input:radio[name=NewBillingFor]:checked').val(), { path: '/' });
                    $.cookie("BookingForSelf", $('input:radio[name=BookingForSelf]:checked').val(), { path: '/' });



                }
                else
                {
                    //alert("test2");
                    $("#alertfrombookcheck").html(data);
                    $("#Bookingavailablecheckalert").modal('show');
                }
            });
        }
    }

    function pad(num, size) {
        var s = num + "";
        while (s.length < size) s = "0" + s;
        return s;
    }
    function checkDate(field) {
        var allowBlank = true; var minYear = 2014; var maxYear = (new Date()).getFullYear()+1;
        // regular expression to match required date format
        re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
        if (field != '') {
            if (regs = field.match(re)) {
                if (regs[1] < 1 || regs[1] > 31)
                { return false; }
                else if (regs[2] < 1 || regs[2] > 12)
                { return false; }
                else if (regs[3] < minYear || regs[3] > maxYear)
                { return false; }
            } else { return false; }
        } else { return false; }
        return true;
    }
    function daydiff(first, second) {
        return (second - first) / (1000 * 60 * 60 * 24);
    }
    function validDates()
    {
        return valdInOutDates();
    }
    function valdInOutDates() {
        var v = $("#start").val().trim();
        if (checkDate(v)) {
            re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
            if (regs = v.match(re)) {
                var cs = new Date(regs[3], regs[2], regs[1]);
                var xo = $("#end").val();
                //                    $("#CheckOut").datepicker("option", "minDate", mind);

                if (checkDate(xo)) {
                    if (regss = xo.match(re)) {
                        var co = new Date(regss[3], regss[2], regss[1]);
                        if (co <= cs) {
                            alert('Please enter a checkout date which falls after checkin date');
                            $("#end").focus();
                            return false;
                        }
                    }
                    else {
                        alert('Invalid Check Out date');
                        $("#end").focus();
                        return false;
                    }
                }
                else {
                    alert('Invalid Check Out date');
                    $("#end").focus();
                    return false;
                }
            }
            else {
                alert('Invalid Check In date');
                $("#start").focus();
                return false;
            }
        } else {
            alert('Invalid Check In date');
            $("#start").focus();
            return false;
        }
        return true;
    }
    $(function () {
        $('[data-toggle="tooltip"]').tooltip({ 'placement': 'top' });
    });

        @*$(function(){
                                        @*var url = '@Url.Action("PolicyText", "Cancellation")?pId=@(Model.PropertyId)';
                                        $.get(url, function (data) {
                                            $("#policytooltip").attr("title",data);
                                        });
                                    });*@
    $('#policytooltip').popover({ trigger: "hover" });
    $(".maxpinfo").popover({trigger:"hover"});
    $("#revisedatebuttton").click(function(){
        $("#confirmdatebutton").show();
        $("#revisedatebuttton").hide();
        $('#start').removeAttr("readonly");
        $('#end').removeAttr("readonly");
        $("#start").removeClass("greybgc");
        $("#end").removeClass("greybgc");
        setCalendar();
        $("#start").focus(); //datepicker('show');
    })
    $("#confirmdatebutton").hide();
    $("#start").addClass("greybgc");
    $("#end").addClass("greybgc");
    </script>


}
catch (Exception ex)
{
    StayBazar.Common.LogHandler.HandleError(ex);
    Response.Redirect("~/Search");
}
<script type="text/javascript">

    //Done By Rahul
    $(function () {



        $('#CorporateID').change(function () {

            $.get("/Common/GetCorporateUserName?id=" + $('#CorporateID').val(), function (data) {
                if (data != "") {
                    $('#CorporateUserID').html(data).append('<option selected="selected" value="0">Select</option>');
                    $('#ddlCorporateUserID').html(data).append('<option selected="selected" value="0">Select</option>');
                }
                else {
                    $('#CorporateUserID').empty().append('<option selected="selected" value="0">not available...</option>');
                    $('#ddlCorporateUserID').html(data).append('<option selected="selected" value="0">Select</option>');
                }

                loadcity();
            });
        });

    });

</script>