@model StayBazar.Models.PropertyModel
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Index";
    int nosAdults = 0, nosChildren = 0;
    int maxGuests;
    int.TryParse(Model.Filter.Adults, out nosAdults);
    int.TryParse(Model.Filter.Children, out nosChildren);
    int dhvgiuebvuif = Model.Accommodations.Accommodations.Count();
    //bool itemRemoved = false;
    //while (itemRemoved)
    //{
    //    itemRemoved = false; //stop flag
    //    foreach (CLayer.Accommodation ac in Model.Accommodations.Accommodations)
    //    {
    //        if (ac.AccommodationCount == 0)
    //        {
    //            Model.Accommodations.Accommodations.Remove(ac);
    //            itemRemoved = true;//found unwanted item
    //            break;
    //        }
    //    }
    //}
    //for (int i = 0; i < Model.Accommodations.Accommodations.Count;i++ )
    //{
    //    if (Model.Accommodations.Accommodations[i].AccommodationCount == 0)
    //    { Model.Accommodations.Accommodations.Remove(Model.Accommodations.Accommodations[i]); }
    //}
    long firstacc = 0;
    List<CLayer.Condition> conditions;
    List<CLayer.Offers> offrs;
    bool showOffer = (Model.UserType != CLayer.Role.Roles.Corporate && Model.UserType != CLayer.Role.Roles.CorporateUser);
    if (showOffer)
    {
        offrs = BLayer.Offers.GetForPropertyCalc(Model.PropertyId, Model.Filter.HiddenCheckIn, Model.Filter.HiddenCheckOut);
    }
    else
    { offrs = new List<CLayer.Offers>(); }
    double avgDailyRate = 0;
    int noOfDays = (Model.Filter.HiddenCheckOut - Model.Filter.HiddenCheckIn).Days;
    string no_image = System.Configuration.ConfigurationManager.AppSettings.Get("NoImageLnk");

    if (Model.Accommodations.Accommodations.Count > 0)
    {
        List<CLayer.Accommodation> accs = Model.Accommodations.Accommodations.OrderBy(m => m.Rate).ToList();
        Model.Accommodations.Accommodations = accs;
    }
    //show Checktime
    long PropertyId = Model.PropertyId;
    CLayer.Property dttime = BLayer.Property.GetCheckTime(PropertyId);

    if (dttime != null)
    {

        if (dttime.MetaDescription != null && dttime.MetaDescription != "")
        {
            ViewBag.MetaDescription = dttime.MetaDescription;
        }
        //else
        //{
        //    ViewBag.MetaDescription = "Experience the best hospitality, service and convenience at " + Model.Title + "Serviced apartments in " + Model.Location + " , " + Model.City; 
        //}


        if (dttime.PageTitle != null && dttime.PageTitle != "")
        {
            ViewBag.Title = dttime.PageTitle;
        }
        else
        {
            //ViewBag.Title = Model.Title + " | " + "Serviced apt in " + Model.Location + ", " + Model.City + " - Staybazar";
            ViewBag.Title = Model.Title;
        }
    }

    ViewBag.PId = Model.PropertyId;
    
    //set mindate 
    int allowmindate = 1;
    if (User.IsInRole("Administrator"))
    {
        allowmindate = 0;
    }

    //set mindate  forcorporate
    long userid = Convert.ToInt32(User.Identity.GetUserId());
    if (userid > 0)
    {
        CLayer.Role.Roles urole = BLayer.User.GetRole(userid);
        if (urole == CLayer.Role.Roles.Corporate)
        {
            DateTime Credirbookingsmedayexp = BLayer.B2B.GetbookingsmedayforCorp(userid);
            if (Credirbookingsmedayexp < DateTime.Now)
            {
                allowmindate = 1;
            }
            else
            {
                allowmindate = 0;
            }
        }
    }
    if (Model.CameFromSearchPage)
    {
        ViewBag.BreadCrumb = " <p style='margin-top: -29px; margin-left: 38px;'> > </p>  <div style='margin-top: -30px; margin-left: 50px;' itemscope itemtype='http://data-vocabulary.org/Breadcrumb'> <a href='#' itemprop='url' class=\"backtosearch whitetext breadhvr\" ><span class=\" whitetext breadhvr\"  itemprop=\"title\">Search</span></a>  </div> <p style='margin-top: -19px; margin-left: 94px;'> > </p> <div style='margin-top: -30px; margin-left: 107px;' itemscope itemtype=\"http://data-vocabulary.org/Breadcrumb\"><span class=\" whitetext breadhvr\"  itemprop=\"title\">Property</span></div>";

    }
    else
    {
        ViewBag.BreadCrumb = " <p style='margin-top: -29px; margin-left: 38px;'> > </p>  <div id='breads' style='margin-top: -30px; margin-left: 50px;'> <div itemscope itemtype='http://data-vocabulary.org/Breadcrumb'> <a href=''  itemprop='url'  class=' whitetext breadhvr' > <span class=' whitetext breadhvr'  itemprop='title'>Property</span></a>  </div> </div>";
    }
}
<link href="~/Content/Loading/waitMe.css" rel="stylesheet" />
<script src="~/Content/Loading/waitMe.js"></script>

<link href="~/Content/lightgallery.css" rel="stylesheet" />


@section scripts{
    <script>
        dataLayer = [{
            'cityName': '@Model.City',
            'locationName': '@Model.Location',
        }];
    </script>
}

<!-- Send Query popup -->
@Html.Partial("~/Views/Property/SendQuery.cshtml")
<!-- Send Query popup -->
<!-- Parallax section -->
@try
{
    <div class="wrapper parallax plx-2" data-speed="4" style="display:none">
        <div class="overlay"></div>
        <div class="content"></div>
    </div>

    <div class="pattern">
        <div class="container">
            <div class="row">
                <div class="col-md-12 selectionctr">
                    <div class="fullwidth pull-left border-radius lightgreybg lightgreyborder padding10px">
@if (Model.InventoryAPIType == 2)
{
                        <h4 class="col-md-12">@Model.Location</h4>
}
else
{
    <h4 class="col-md-12">@Model.Location,@Model.City</h4>
}
                        @if (Model.CameFromSearchPage)
                        {

                            <div class="col-md-12">
                                <a href="#" onclick="location.href = document.referrer; return false;" class="redtext underline backtosearch">&#60; Back to search results</a>
                                
                                &#124;
                                <a href="#" class="redtext underline backtosearch">Modify Search</a>
                            </div> }
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <span class="name HotelName">@Model.Title</span> 
                    @if (Model.Rating > 0)
                    {
                        <span style="font-size:22px!important">@(Html.Raw(StayBazar.Common.Utils.GetStarRating(Model.Rating)))</span>
                    }

                    @*<span class="star">
                            <i class="glyphicon glyphicon-star st-active"></i>
                            <i class="glyphicon glyphicon-star st-active"></i>
                            <i class="glyphicon glyphicon-star st-active"></i>
                            <i class="glyphicon glyphicon-star"></i>
                            <i class="glyphicon glyphicon-star"></i>
                        </span>*@
                    @if (Model.InventoryAPIType == 2)
                    {
                        <address class="greytext">
                            @Model.Address
                            @*@if (Model.State != null)
                            {<text>, </text>@Model.StateName;
                            }@if (Model.ZipCode != null && Model.ZipCode != "")
                            { <text>, </text> @Model.ZipCode}@if (Model.Country != null)
                            {<text>, </text>@Model.CountryName;
                            }*@
                        </address>
                    }
                    else
                    {
                        <address class="greytext">
                            @Model.Address@if (Model.City != null && Model.City != "")
                            { <text>, </text>@Model.City}
                            @if (Model.State != null)
                            {<text>, </text>@Model.StateName;
                            }@if (Model.ZipCode != null && Model.ZipCode != "")
                            { <text>, </text> @Model.ZipCode}@if (Model.Country != null)
                            {<text>, </text>@Model.CountryName;
                            }
                        </address>
                    }
                   
                </div>
            </div>
            <div class="row searchgallery">
                <div class="col-md-8 ">

                    <!-- main slider carousel -->

                    <div class="col-md-12 pad0" id="slider">
                        <div id="carousel-bounding-box">
                            <div id="gallery" class="carousel slide">
                                <!-- main slider carousel items -->
                                <div class="carousel-inner lightgallery">
                                    @{
                                        int carouselIndex = 0;
                                        bool imagesFound = false;
                                        int divid = 0;
                                    }
                                                                        @foreach (CLayer.PropertyFiles pf in Model.Pictures.Pictures)
                                                                        {
                                                                            divid++;
                                                                            string FileName = (pf.FileName.Length > 2) ? pf.FileName.Substring(0, pf.FileName.Length - 2) : "";

                                                                                <div id="divid@(divid)" class="galleryalign item @if(carouselIndex ==0){<text>active</text>}" data-responsive="@FileName" data-src="@FileName">
                                                                                    <span class="crop">  <img data-divid="divid@(divid)" class="cgimg" src="@FileName" title="@(carouselIndex)" alt="@Model.Title serviced apartment in  @Model.Location @Model.City" /> </span>
                                                                                </div>
                                                                           
                                                                            carouselIndex++;
                                                                            if (!imagesFound) { imagesFound = true; }

                                                                        }
                                    @if (Model.Pictures.Pictures.Count == 0 || (!imagesFound))
                                    {
                                        <div class="item active">
                                            <img src="~/@no_image" title="1" alt="1" />
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/main slider carousel-->
                    <!-- thumb navigation carousel -->
                    <div class="col-md-12 AdjustThumbs" id="slider-thumbs">
                        <!-- thumb navigation carousel items -->
                        <ul class="list-inline lightgallery">
                            @{
                                    int carouselSelector = 0;
                                    imagesFound = false;
                            }
                            @foreach (CLayer.PropertyFiles pf in Model.Pictures.Pictures)
                            {
                                string FileName = (pf.FileName.Length > 2) ? pf.FileName.Substring(0, pf.FileName.Length - 2) : "";
                                    <li data-responsive="@FileName" data-src="@FileName">
                                        <img src="@pf.FileName" title="@(carouselSelector)" alt="@(carouselSelector)" />
                                    </li>
                                    carouselSelector++;
                                    if (!imagesFound) { imagesFound = true; }
                                
                            }
                            @if (Model.Pictures.Pictures.Count == 0 || (!imagesFound))
                            {
                                <li>
                                    <img src="~/@no_image" title="1" alt="1" />
                                </li>
                            }
                        </ul>
                    </div>
                    @*@if (carouselSelector == 0)
                        {
                            <span class="h2">No Image available.</span>
                        }*@
                </div>
                <div class="col-md-4">
                    <div class="lightgreybg lightgreyborder pull-left over_div">
                        <div class="redbg fullwidth pull-left padding10px">
                            <div class="pull-left">
                                <div class="whitetext">
                                    <span id="BookingTotal" style="display:none">0@*<small>00</small>*@</span>
                                    @*<span style="font-size:22px">Revise booking</span>*@
                                </div>
                                <p class="onwards lightgreytext"></p>
                            </div>
                            @*@{
                                    string PartialAmount = BLayer.Property.GetPropertypartialamount(Model.PropertyId);
                                <script type="text/javascript">
                                    $("#PartialPayAmount").val(@PartialAmount);
                                    alert($("#PartialPayAmount").val());
                                </script>

                                                        }*@

                            <div id="loading" class="loader" style="display:none;"> 
                                <div class="center_load">
                                    <img src="~/images/loading.gif"  width="30" height="30" />
                                </div> 
                            </div>
                            <div class="pull-right bookdiv">

                              
                                @if ((Model.Accommodations.Accommodations.Count > 0 )||(ViewBag.AmedusRoomsList > 0)) { 

                                    <form method="post" action="@Url.Action("Book","booking")" id="BookAccommodation" >

                                        <input type="hidden" id="BookingData" name="BookingData" />
                                        <input type="hidden" id="PropertyId" name="PropertyId" value="@Model.PropertyId" />
                                        <input type="hidden" id="BookCheckIn" name="BookCheckIn" value="@Model.Filter.HiddenCheckIn" />
                                        <input type="hidden" id="BookCheckOut" name="BookCheckOut" value="@Model.Filter.HiddenCheckOut" />
                                        @*<input id="property_booknow" onclick="bookAccommodation()" type="button" class="btn btn-success" value="Book now!" />*@
                                    </form>
                                }
                            </div>
                        </div>
                        <div class="padding10px pull-left fullwidth">
                            @*<div>
                                    <b class="">@Model.Rating</b>&nbsp;out of
                                    <b>5</b>
                                    <span class="greytext">Staybazar user ratings</span>
                                </div>
                                <div>
                                    <b class="">@(StayBazar.Common.Utils.GetRatingPercentage(Model.Rating))</b>
                                    <span class="greytext">users recommend this</span>
                                </div>*@
                            <div class="col-xs-12 col-md-12 whitebg lightgreyborder">
                                <div class="col-xs-6 col-md-6 checkin">
                                    <span>Check in</span>
                                    <div class="hidden">
                                        @using (Html.BeginForm("revise", "property", FormMethod.Post, new { id = "bsearchform", onsubmit = "return validDates()" }))
                                        {
                                            <input type="hidden" value="@Model.Filter.PropertyId" id="PropertyId" name="PropertyId" />
                                            <input type="hidden" value="@Model.Filter.Destination" id="Destination" name="Destination" />
                                            <input type="hidden" value="@Model.Filter.Adults" id="Adults" name="Adults" />
                                            <input type="hidden" value="@Model.Filter.Children" id="Children" name="Children" />
                                            <input type="hidden" value="@Model.Filter.Bedrooms" id="Bedrooms" name="Bedrooms" />
                                            <input type="hidden" value="@Model.Filter.StayType" id="StayType" name="StayType" />
                                            <input type="hidden" value="@Model.Filter.CheckIn" id="CheckIn" name="CheckIn" />
                                            <input type="hidden" value="@Model.Filter.CheckOut" id="CheckOut" name="CheckOut" />
                                            <input type="hidden" value="@Model.Filter.HidAdults" id="HidAdults" name="HidAdults" />
                                            <input type="hidden" value="@Model.Filter.HidBedrooms" id="HidBedrooms" name="HidBedrooms" />
                                            <input type="hidden" value="@Model.Filter.HiddenCheckIn" id="HiddenCheckIn" name="HiddenCheckIn" />
                                            <input type="hidden" value="@Model.Filter.HiddenCheckOut" id="HiddenCheckOut" name="HiddenCheckOut" />
                                            <input type="hidden" value="@Model.Filter.HidChildren" id="HidChildren" name="HidChildren" />
                                            <input type="hidden" value="@Model.Filter.CurrentPage" id="CurrentPage" name="CurrentPage" />
                                            <input type="hidden" value="@Model.Filter.HiddenDestination" id="HiddenDestination" name="HiddenDestination" />
                                            <input type="hidden" value="@Model.Filter.Location" id="Location" name="Location" />
                                            <input type="hidden" value="@Model.Filter.distanceInKm" id="distanceInKm" name="distanceInKm" />
                                            <input type="hidden" value="@Model.Filter.features" id="features" name="features" />
                                          
                                            <input type="hidden" value="@Model.Filter.rangeBudgetMin" id="rangeBudgetMin" name="rangeBudgetMin" />
                                            <input type="hidden" value="@Model.Filter.rangeBudgetMax" id="rangeBudgetMax" name="rangeBudgetMax" />
                                            <input type="hidden" value="@Model.Filter.HidStayType" id="HidStayType" name="HidStayType" />
                                        }
                                    </div>
                                    <div>
                                        <input type="text" readonly="readonly" id="start" @if (Model.Filter.HiddenCheckIn > DateTime.MinValue) {  <text> value="@Model.Filter.HiddenCheckIn.ToShortDateString()" </text>                     } placeholder="Check In">
                                    </div>
                                </div>
                                <div class="col-xs-6 col-md-6 checkout">
                                    <span>Check out</span>
                                    <div>
                                        <input type="text" readonly="readonly" id="end" @if (Model.Filter.HiddenCheckOut > DateTime.MinValue) {  <text> value="@Model.Filter.HiddenCheckOut.ToShortDateString()" </text>                     } placeholder="Check Out">
                                    </div>
                                </div>
                                <div style="display:none">
                                    <div class="col-xs-6 col-md-6 selectspacer">
                                        <span>Adults (10+ yrs)</span>
                                        <input type="hidden" id="Adults" name="Adults" value="@Model.Filter.Adults" />
                                        <div class="specSpin"><div id="spnrAd"></div></div>
                                    </div>
                                    <div class="col-xs-6 col-md-6 pad0">
                                        <span>Children( &lt;10 yrs )</span>
                                        <div class="specSpin">
                                            <div id="spnrCd"></div>
                                        </div>
                                        <input type="hidden" id="Children" name="Children" value="@Model.Filter.Children" />
                                    </div>

                                    <div class="col-xs-6 col-md-6 pad0">
                                        <span>Rooms</span>
                                        <div class="specSpin">
                                            <div id="spnrBed"></div>
                                        </div><input type="hidden" name="BedRooms" id="BedRooms" value="@Model.Filter.Bedrooms" />

                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-12 text-center padding10px">
                                    <button type="submit" id="confirmdatebutton" class="btn btn-default" onclick="reviseDates()">Confirm dates</button>
                                    <button type="submit" id="revisedatebuttton" class="btn btn-default">Revise dates</button>
                                </div>
                                <div class="row"><div class="col-md-12"><div class="revisetext">If you need to book for different dates please use "Revise Dates" button</div></div></div>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-12" style="padding-top:10px">
                        @{
                            string UserIds = User.Identity.GetUserId();
                            CLayer.Role.Roles UsertypeId = BLayer.User.GetRole(Convert.ToInt32(UserIds));
                            decimal Partialamountperc = 0;
                            if (UsertypeId == CLayer.Role.Roles.Customer || UsertypeId == CLayer.Role.Roles.Administrator)
                            {
                                Partialamountperc = Math.Round(BLayer.Property.GetPropertyB2CpartialamountPerc(Model.PropertyId));

                            }
                            if (UsertypeId == CLayer.Role.Roles.Corporate || UsertypeId == CLayer.Role.Roles.Affiliate || UsertypeId == CLayer.Role.Roles.Supplier || UsertypeId == CLayer.Role.Roles.CorporateUser)
                            {
                                Partialamountperc = Math.Round(BLayer.Property.GetPropertyB2BpartialamountPerc(Model.PropertyId));

                            }
                        }
                        @if (Partialamountperc > 0)
                        {
                            <div class="row margin-bot-10">
                                <div class="col-md-12" style="">
                                    <div class="lightgreybg  enquirebtnbx lightgreyborder text-center">
                                        <h4>Partial/Full Payment Options available</h4>
                                    </div>
                                </div>
                            </div>
                        }


                        <div class="row margin-bot-10">
                            <div class="col-md-12" style="">
                                <div class="lightgreybg  enquirebtnbx lightgreyborder text-center">

                                    <input type="button" class="btn btn-danger whitetext enquirebtn" onclick="SendQuery()" value="Enquire Now" />

                                </div>
                            </div>
                        </div>
                        @*@if (Model.Landmarks.Landmarks.Count > 0)
            {
                <div class="row">
                    <div class="col-md-12">
                        <div class="whitebg lightgreyborder pull-left">
                            <div class="lightgreybg fullwidth pull-left padding10px">
                                <h4>Near by Landmarks &amp; Areas</h4>
                            </div>
                            <div class="padding10px pull-left fullwidth">
                                <ul>
                                    @foreach (CLayer.Landmarks lm in Model.Landmarks.Landmarks)
                                    {
                                        <li>
                                            @lm.Landmark - <span class="km">@lm.Range</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            }*@

                        <div class="row">
                            <div class="col-md-12">
                                <div class="map_canvas"></div>
                            </div>
                        </div>



                    </div>
                </div>
            </div>
            <div class="row room-details border-radius topmargin10">
    <div class="col-md-8">
        <div class="col-md-12 GDSHotel-Details">
            @*<div class="col-md-12 no-padding hoteloverview hotel-DESC">
                <h4>@Model.Title</h4>
                @{
                    string GDSHotelDetails = string.Empty;
                    string GDSHotelAdditionalDetails = string.Empty;
                }
                @if (string.IsNullOrEmpty(Model.FormattedDescription))
                {
                    string[] DescriptionList = Model.Description.Split(new string[] { "#256#" }, StringSplitOptions.RemoveEmptyEntries);
                    for (int i = 0; i < DescriptionList.Length; i++)
                    {
                        <p style="line-height:20px">@Html.Raw(DescriptionList[i].Replace("--------", ""))</p>
                    }
                }
                else
                {
                    string[] FormattedDescriptionList = Model.FormattedDescription.Split(new string[] { "#256#" }, StringSplitOptions.RemoveEmptyEntries);
                    for (int i = 0; i < FormattedDescriptionList.Length; i++)
                    {
                        GDSHotelDetails = FormattedDescriptionList[0];
                        if (FormattedDescriptionList.Length > 1)
                        {
                            GDSHotelAdditionalDetails = FormattedDescriptionList[1];
                        }

                    }
                    int Hotellength = GDSHotelDetails.Length > 491 ? 491 : GDSHotelDetails.Length;

                    <div id="dvPartialContent">
                        <p>@Html.Raw(GDSHotelDetails.Substring(0, Hotellength))</p>
                        @if (GDSHotelDetails.Length > 491)
                        {
                            <a href="javascript:void(0)" id="dvContentMore" class="redtext" style="float:right!important">more..</a>
                        }

                    </div>
                    <div id="dvFullContent" style="display:none"><p>@Html.Raw(GDSHotelDetails)</p><a href="javascript:void(0)" id="dvContentLess" class="redtext" style="float:right!important">less..</a></div>

                }

            </div>*@
            @if (showOffer && offrs.Count > 0)
            {
                CLayer.Offers offr = offrs[0];
                <div class="row">
                    <div class="col-md-12">
                        <p>
                            <h4>OFFER: @offr.OfferTitle</h4>
                            <div>This offer is for all the Accommodations in this property. Expires on @(offr.EndDate.ToShortDateString())</div>
                        </p>
                    </div>
                </div>
            }

            @if (Model.Accommodations.Accommodations.Count > 0)
            {
                if (firstacc == 0) { firstacc = Model.Accommodations.Accommodations[0].AccommodationId; }

                <div class="col-md-12 table-in">
                    <table class="table table-bordered fixme">
                        <thead>
                            <tr class="time-in">
                                <th class="main-1">Room Type</th>
                                <th class="main-2">Max</th>
                                <th class="main-3">Avg Daily Rate</th>
                                <th class="main-4"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (CLayer.Accommodation ac in Model.Accommodations.Accommodations)
                            {
                            @*<input type="checkbox" id="@ac.AccommodationId" value="@ac.Rate" class="SelectBooking" onclick="SelectAcc(@ac.AccommodationId)" data-value="@ac.AccommodationId">
                            <label style="padding-left:10px">Select Accommodation</label>*@

                            maxGuests = ac.MaxNoOfPeople;//  -ac.MinNoOfPeople;
                            if (maxGuests < 0) { maxGuests = 0; }
                            if (showOffer)
                            {
                            offrs = BLayer.Offers.GetForAccommodationCalc(ac.AccommodationId, Model.Filter.HiddenCheckIn, Model.Filter.HiddenCheckOut);
                            if (offrs.Count > 0)
                            {
                            CLayer.Offers offr = offrs[0];
                            <div class="row">
                                <div class="col-md-12">
                                    <p>
                                        <h4>OFFER: @offr.OfferTitle</h4>
                                        <div>The offer is valid for the accommodation below. Expires on @(offr.EndDate.ToShortDateString())</div>
                                    </p>
                                </div>
                            </div>
                            }
                            }
                            avgDailyRate = Math.Round((double)ac.Rate / noOfDays);


                            @*formatted accommodation details*@




                            <tr>
                                <td>
                                    <p class="room-name">@ac.RoomTypeDecription</p>
                                    <p class="qut">@ac.Description</p>
                                    <p>
                                        @if (!string.IsNullOrEmpty(ac.MealPlan))
                                        {
                                            <span><strong>Included</strong>:@ac.MealPlan</span> <br />
                                        }

                                        @if (Model.UserType == CLayer.Role.Roles.Administrator)
                                        {
                                            if (!string.IsNullOrEmpty(ac.MealPlan))
                                            {
                                                <span><strong>Commission</strong>: @ac.CommissionPercent</span>
                                            }

                                        }
                                    </p>


                                </td>
                                <td><div >

                                     
        @if (ac.MinNoOfPeople < 4)
        {
            for (int ii = 0; ii < ac.MinNoOfPeople; ii++)
            {
                <p><span class="fa fa-male max_adult_size"></span></p>
            }
        }
        else
        {
            <p> <text>@ac.MinNoOfPeople X <span class="fa fa-male max_adult_size"></span></text></p>
        }
            
           <p>
        @if (ac.MaxNoOfChildren < 4)
        {
            for (int ii = 0; ii < ac.MaxNoOfChildren; ii++)
            {
                <span class="fa fa-male max_child_size"></span>
            }
        }
        else
        {
            <text>@ac.MaxNoOfChildren X <span class="fa fa-male max_child_size"></span></text>
        }
    </p>
                                    <a class="maxpinfo" href="#" data-toggle="popover" data-html="true" data-content="These are adults/children limits exceeding which additional guest charges will be applied "><span class="glyphicon glyphicon-info-sign"></span></a>
                                </div></td>
                                <td><span class="fa cxprice fa-rupee"> </span>@avgDailyRate</td>
                                <td>
                                    <p><span class="fa cxprice fa-rupee"></span>@Math.Round(ac.Rate, 0)</p>
                                    <input id="property_booknow" onclick="bookAccommodation(@ac.AccommodationId)" type="button" class="btn btn-success" value="Book now!">
                                </td>
                            </tr>
                         




                            

                            } @*//for loop ends*@
                        </tbody>
                    </table>
                    <div class="row ">
                        <div class="col-md-8 col-md-offset-0">
                            <div>Prices are per accommodation</div>
                            <div><b>Taxes are included&nbsp;</b></div>
                        </div>
                    </div>
                </div>


                                            }
                                            else
                                            {
                                                <div class="row ">
                                                    <div class="col-md-8 col-md-offset-2">
                                                        <div class="alert alert-info"> Stay options are not available in date range and options you have selected. Please select alternate date range or options to proceed.</div>
                                                    </div>
                                                </div>

                                            }




            @*<a id="policytooltip" class="info-tooltip" data-toggle="tooltip" data-html="true" *@
            @*@if (Model.InventoryAPIType == (int)CLayer.ObjectStatus.InventoryAPIType.Amadeus)*@
                @*{
                    if (!string.IsNullOrEmpty(GDSHotelAdditionalDetails))
                    {
                    <div class="col-md-12">
                        <div class="row">

                            <div class="col-md-12 hoteloverview no-padding box-2-inner">

                                <div>@Html.Raw(GDSHotelAdditionalDetails)</div>
                            </div>

                        </div>
                    </div>
                }*@
            @*}*@
            @*else
            {*@
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-8">
                            @if (dttime != null)
                            {
                                string CheckInTime = dttime.CheckInTime;
                                string CheckOutTime = dttime.CheckOutTime;
                                int ChildAgeLimit = dttime.AgeLimit;

                                if (ChildAgeLimit > 0)
                                {
                                    <div>Children Age Limit is @ChildAgeLimit&nbsp;years </div>
                                }
                                if (CheckInTime != "" || CheckOutTime != "")
                                {
                                    <div>Check In Time: @CheckInTime &nbsp;&nbsp; Check Out Time: @CheckOutTime</div>
                                }
                            }
                        </div>
                        <div class="col-md-4">
                            <div class="rightalign" id="cancBox"><a class="handpointer" id="policytooltip" data-toggle="popover" data-placement="left" data-html="true" data-content="@Html.Partial("~/Views/Cancellation/_PolicyText.cshtml",Model.PropertyId)">Cancellation Policy</a></div>
                        </div>
                    </div>

                </div>
            @*}*@
          
            <div class="col-md-8 no-padding short-note">
                <span style="font-size:11px;color:#a51e22;">*Based on the availability at the time of check-in</span>
            </div>
        </div>
        </div>


                 
             

                </div>
                <div class="row room-tab">
                    <div class="col-md-12" style="display:none">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#hotel_details" data-toggle="tab">Property Details</a>
                            </li>
                            @*<li>
                                    <a href="#reviews" data-toggle="tab">User Reviews</a>
                                </li>*@
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div class="tab-pane hotel_details active" id="hotel_details">
                                <h5>Features</h5>
                                <div class="row">
                                    @{
                                        List<CLayer.PropertyFeature> pfeatures = BLayer.PropertyFeature.GetFeaturesForProperty(Model.PropertyId);
                                        int flen = pfeatures.Count;
                                        int fclm = flen;
                                        int sclm = flen;
                                        if (flen > 17)
                                        {
                                            int rm = flen % 3;
                                            fclm = flen / 3;
                                            sclm = (fclm * 2) + rm;
                                            if (rm > 1) { rm = 1; }
                                            fclm = fclm + rm;
                                        }
                                        else
                                            if (flen > 8)
                                        {
                                            fclm = flen / 2 + (flen % 2);
                                        }
                                        if (flen > 0)
                                        {
                                            <div class="col-md-4">
                                                @for (int i = 0; i < fclm; i++)
                                                {
                                                    <div class="feat-icon nobdr @pfeatures[i].Style">
                                                        <label>@pfeatures[i].Title</label>
                                                    </div>
                                                }
                                            </div>
                                            if (sclm < flen)
                                            {
                                                <div class="col-md-4">
                                                    @for (int i = fclm; i < sclm; i++)
                                                    {
                                                        <div class="feat-icon nobdr @pfeatures[i].Style">
                                                            <label>@pfeatures[i].Title</label>
                                                        </div>
                                                    }
                                                </div>
                                            }
                                            if (fclm < flen)
                                            {
                                                if (flen != sclm) { fclm = sclm; }
                                                <div class="col-md-4">
                                                    @for (int i = fclm; i < flen; i++)
                                                    {
                                                        <div class="feat-icon nobdr @pfeatures[i].Style">
                                                            <label>@pfeatures[i].Title</label>
                                                        </div>

                                                    }
                                                </div>
                                            }
                                        }

                                    }
                                </div>
                            </div>
                            @*<div class="tab-pane" id="reviews">
                                    @Html.Partial("~/Views/Widget/_Review.cshtml", Model.PropertyId)
                                </div>*@


                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        @Html.Partial("~/Views/Widget/_Review.cshtml", Model.PropertyId)
                    </div>
                </div>
            </div>
        </div>

   @*<div class="whitebg">
       <div class="container ctrpad">
          
       </div>
    </div>*@

    
    <div id="accommodationGallery" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Accommodation Details</h4>
                </div>
                <div id="galleryData" class="modal-body">
                    @Html.Partial("~/Views/Property/_AccommodationGallery.cshtml", Model.Accommodations.Accommodation)
                </div>
            </div>
        </div>
    </div>

    <div class="whitebg">
        <div class="container ctrpad">
            <div class="row">
                <!--  Most -->
                @Html.Partial("~/Views/Widget/_InterestedProperties.cshtml", Model.PropertyId)
                <!--  Most popular section End -->
                <!-- Testimonials Section -->
                @*@Html.Partial("~/Views/Review/_widget.cshtml", Model.PropertyId)*@
                @Html.Partial("~/Views/Testimonials/_widget.cshtml")
                <!-- Testimonials Section End-->
            </div>
        </div>
    </div>
    <input type="text" style="display:none;" id="hiddenmindate" name="hiddenmindate" value="@allowmindate" />

  

    <div id="Bookingavailablecheckalert" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" style="width:34%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Not available</h4>
                </div>
                <div id="maximojo" class="modal-body">
                    <h5 class="redtext" id="alertfrombookcheck"> </h5>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-primary"  data-dismiss="modal" aria-hidden="true">Ok</button></div>
            </div>
        </div>
    </div>


    @*<script type='text/javascript' src="https://maps.google.com/maps/api/js?sensor=false&callback=MapApiLoaded"></script>*@
    @*<script type='text/javascript' src="https://maps.google.com/maps/api/js?sensor=false"></script>*@

    <script type="text/javascript">
        var SelectedIDS = false;
        var BookedData = '';
        var BookedID = 0;
        function SelectAcc(ids, val) {
           
            var id = "#" + ids + "";
            var y = $(id).val();

            var n = '@HttpContext.Current.Session["Adults"]';

            var noaccom = parseInt('@HttpContext.Current.Session["Bedrooms"]');
            noaccom = (noaccom <= 0) ? 1 : noaccom;

            var adults = parseInt('@HttpContext.Current.Session["Adults"]');
            adults = (adults <= 0) ? 1 : adults;

            var child = parseInt('@HttpContext.Current.Session["Children"]');
            child = (child <= 0) ? 0 : child;
            var guests = adults + child;


            var BookingSelected = ',' + noaccom.toString() + ',' + adults.toString() + ',' + child.toString() + ',' + guests.toString();

            if (SelectedIDS ==true) {
                if (($("#BookingTotal").html() != "0") && (ids != BookedID)) {
                    $("#alertfrombookcheck").html('Please select any one room type');
                    $("#Bookingavailablecheckalert").modal('show');
                    $(id).attr('checked', false);
                   // SelectedIDS = false;

                    var bookingdatas = $("#BookingData").val();
                    var data = "";
                    if (bookingdatas != "") {

                        var deleted = "#" + ids + BookingSelected;
                        data = bookingdatas.replace(deleted, '');

                    }
                    $("#BookingData").val(data);
                    return false;
                }
            }

            if($(id).is(":checked") == true){

                BookedID = ids;
                var bookingdatas=$("#BookingData").val();
                var data="";
                if(bookingdatas!="")
                {
                 //   data = bookingdatas + "#" + ids + ",1,0,1,1";
                    data = bookingdatas + "#" + ids + BookingSelected;
                }
                else
                {
                 //   data = "#" + ids + ",1,0,1,1";
                    data = "#" + ids + BookingSelected;
                }
                $("#BookingData").val(data);

                var amount =0;
                var gtotal=0;
                var total=  $("#BookingTotal").html();
                if(total!="")
                {
                    gtotal = parseFloat(total) + parseFloat(y);
                }
                else{
                    gtotal=y;
                }
                $("#BookingTotal").html(htmlCurr(gtotal));
                SelectedIDS = true;
                BookedData = bookingdatas;
            }
            else
            {

                var bookingdatas=$("#BookingData").val();
                var data="";
                if(bookingdatas!="")
                {
                   // var deleted="#"+ids+",1,0,1,1";
                    var deleted = "#" + ids + BookingSelected;
                    data = bookingdatas.replace(deleted,'');

                }
                $("#BookingData").val(data);


                var gtotal=0;
                var total=  $("#BookingTotal").html();
                if(total!="")
                {
                    gtotal = parseFloat(total) - parseFloat(y);
                }
                if(gtotal==""|| gtotal==0)
                {
                    gtotal="00";
                }
                else{
                    gtotal = parseFloat(gtotal);
                }
                gtotal = "00";
                $("#BookingTotal").html(htmlCurr(gtotal));
                BookedData = "";
                SelectedIDS = false;
            }
        }


           function SelectAccommodation(ids, val) {
          
            var id = "#" + ids + "";
            var y = $(id).val();

            var n = '@HttpContext.Current.Session["Adults"]';

            var noaccom = parseInt('@HttpContext.Current.Session["Bedrooms"]');
            noaccom = (noaccom <= 0) ? 1 : noaccom;

            var adults = parseInt('@HttpContext.Current.Session["Adults"]');
            adults = (adults <= 0) ? 1 : adults;

            var child = parseInt('@HttpContext.Current.Session["Children"]');
            child = (child <= 0) ? 0 : child;
            var guests = adults + child;


            var BookingSelected = ',' + noaccom.toString() + ',' + adults.toString() + ',' + child.toString() + ',' + guests.toString();

         

                BookedID = ids;
                var bookingdatas=$("#BookingData").val();
                var data="";
                if(bookingdatas!="")
                {
                 //   data = bookingdatas + "#" + ids + ",1,0,1,1";
                    data = bookingdatas + "#" + ids + BookingSelected;
                }
                else
                {
                 //   data = "#" + ids + ",1,0,1,1";
                    data = "#" + ids + BookingSelected;
                }
                $("#BookingData").val(data);

                var amount =0;
                var gtotal=0;
                var total=  $("#BookingTotal").html();
                if(total!="")
                {
                    gtotal = parseFloat(total) + parseFloat(y);
                }
                else{
                    gtotal=y;
                }
                $("#BookingTotal").html(htmlCurr(gtotal));
                SelectedIDS = true;
                BookedData = bookingdatas;

             
           
           
        }

        //$(".SelectBooking").click(function(ids){
        //    debugger
        //    var datas = $("#data-value").val();
        //    var amount=  $(this).val();
        //

        //    }



        //});

        function SendQuery() {
            $('#Sendquerypop').modal('show');
        }
    </script>
    <script type='text/javascript'>
        $(window).resize(function () {
            imgadj();
        });

        imgadj();

        function imgadj() {

            $(".img-thumb").each(function () {
                var refH = $(this).height();
                var refW = $(this).width();
                var refRatio = refW / refH;
                var imgH = $(this).children("img").height();
                var imgW = $(this).children("img").width();

                if ((imgW / imgH) < refRatio) {
                    $(this).addClass("portrait");
                } else {
                    $(this).addClass("landscape");
                }
            })
        }
    </script>
    <script type='text/javascript'>
        @*function MapApiLoaded() {
            debugger;
            // Latitude of google maps destination location
            var gmapsLatitude = @(Model.PositionLat);

            // Longitude of google maps destination location
            var gmapsLongitude = @(Model.PositionLng);

            // Enable the visual refresh
            google.maps.visualRefresh = true;

            var map, mapOptions = {
                zoom: 10,
                center: new google.maps.LatLng(gmapsLatitude, gmapsLongitude),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                scrollwheel: true
            };
            map = new google.maps.Map($('.map_canvas').get(0),
                mapOptions);

            new google.maps.Marker({
                position: new google.maps.LatLng(gmapsLatitude, gmapsLongitude),
                map: map
            });

        }*@
    </script>
    <script type='text/javascript'>
        for (i = -1; i <= $('.carousel-inner').children().length; i++) {
            $(".carousel-inner div:nth-child(" + i + ")").attr('data-slide-number', i);
            $("#slider-thumbs ul li:nth-child(" + i + ")").attr('id', 'carousel-selector-' + i + '');
        }

        $('#gallery').carousel({
            interval: false
        });

        function thumbactive() {
            var id = $('.item.active').data('slide-number');
            id = parseInt(id);

            $(".list-inline li").removeClass("selected");
            $('[id=carousel-selector-' + id + ']').addClass('selected');

        }

        thumbactive(); //To initialize the active thumbnail

        // when the carousel slides, auto update
        $('#gallery').on('slid.bs.carousel', function (e) {
            thumbactive();
        });
        // handles the carousel thumbnails
        //$('.list-inline li img').hover(function () {
        //    var id_selector = $(this).attr("title");
        //    $('#gallery').carousel(parseInt(id_selector));


        //});
        var tOut;
        $('.list-inline li img').hover(function () {
            var id_selector = $(this).attr("title");
            tOut = setTimeout(function () {
                $('#gallery').carousel(parseInt(id_selector));

            }, 500);
        }, function () {
            clearTimeout(tOut);
        });

    </script>
    <script type='text/javascript'>
        $('td .styleselect2').on('change', function () {
            $(this).parents("td").find(".person").remove();
            for (i = 0; i < $(this).val() ; i++) {
                $(this).parents("td").find(".persons").append("<div class='person'></div>")
            }
        });
    </script>
    <script type="text/javascript">
        function gallery(id) {
            $.get('@(Url.Action("GetAccommodation", "Property"))?id=' + id, function (data) {
                if (data != null) {
                    $("#galleryData").html(data);
                    $("#accommodationGallery").modal('show');
                }
            });
        }
    </script>
    
    <script>

    function setCalendar()
    {

        var now = new Date();
        now.setDate(now.getDate() + 7);

        var checkin = $('#start').datepicker(
            {
                minDate:$("#hiddenmindate").val(),
                defaultDate: now,
                numberOfMonths: 2,
                dateFormat: "dd/mm/yy"
            });
        now.setDate(now.getDate() + 2);
        var checkout = $('#end').datepicker({
            minDate: 2,
            numberOfMonths: 2,
            defaultDate: now,
            dateFormat: "dd/mm/yy"
        });
    }
    $(function () {



        $("#start").change(function () {
            var v = $(this).val().trim();

            var curDate = new Date();
            curDate.setDate(curDate.getDate()+1);
            var idat = pad(curDate.getDate(), 2) + "/" + pad(parseInt(curDate.getMonth())+1, 2) + "/" + curDate.getFullYear();
            curDate.setDate(curDate.getDate()+ 2);
            var odat =  pad(curDate.getDate(), 2) + "/" + pad(parseInt(curDate.getMonth())+1, 2) + "/" + curDate.getFullYear();

            if (checkDate(v)) {
                re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
                if (regs = v.match(re)) {
                    var day,mnt,yr;
                    yr = parseInt(regs[3]);
                    mnt = parseInt(regs[2]);
                    dy =parseInt(regs[1]);
                    if(mnt>0) mnt = mnt - 1;
                    var cd = new Date(Date.UTC(yr,mnt,dy));
                    cd.setDate(cd.getDate()+2);
                    var mn = cd.getMonth() + 1; //parseInt(cd.getMonth()) + 1;
                    var chgDt = pad(cd.getDate(), 2) + "/" + pad(mn, 2) + "/" + cd.getFullYear();
                    // alert(chgDt);
                    var cs = new Date(Date.UTC(yr, mnt, dy));
                    var mind = new Date(Date.UTC(yr, mnt, dy));
                    mind.setDate(mind.getDate() + 1);
                    var mindx = pad(mind.getDate(), 2) + "/" + pad(parseInt(mind.getMonth())+1, 2) + "/" + mind.getFullYear();
                    var xo = $("#end").val();
                    //                    $("#CheckOut").datepicker("option", "minDate", mind);

                    if (checkDate(xo)) {
                        if (regss = xo.match(re)) {
                            yr = parseInt(regss[3]);
                            mnt = parseInt(regss[2]);
                            dy =parseInt(regss[1]);
                            if(mnt>0) mnt = mnt - 1;
                            var co = new Date(Date.UTC(yr, mnt, dy));
                            if (co <= cs) {
                                $("#end").val(chgDt);
                                // $("#CheckOut").datepicker("option", "setDate", cd);
                            }
                        }
                        else {
                            // $("#CheckOut").datepicker("option", "setDate", cd);
                            $("#end").val(chgDt);
                        }
                    }
                    else {
                        // $("#CheckOut").datepicker("option", "setDate", cd);
                        $("#end").val(chgDt);
                    }
                    //checkout.minDate = n;
                    $("#end").datepicker("option", "minDate", mindx);
                    //$("#CheckOut").datepicker("show");
                }
                else { $("#start").val(idat);$("#end").val(odat); }
            }
            else { $("#start").val(idat);$("#end").val(odat); }
        });


                $("#spnrAd").dpNumberPicker({
            value:@{if (Model.Filter.Adults == null || Model.Filter.Adults == "")
                    {<text>1</text>} else {<text>@Model.Filter.Adults</text>}},
            min: 1,
            max: 8,
            step: 1,
            afterChange: function () { $("#Adults").val(this.options.value); }
        });
        $("#spnrCd").dpNumberPicker({
            value: @{if (Model.Filter.Children == null || Model.Filter.Children == "")
                     {<text>0</text>} else {<text>@Model.Filter.Children</text>}},
            min: 0,
            max: 8,
            step: 1,
            afterChange: function () { $("#Children").val(this.options.value); }
                });

        @*$("#spnrBed").dpNumberPicker({
                 value: @{if (Model.Filter.Bedrooms == null || Model.Filter.Bedrooms == "")
                     {<text>0</text>} else {<text>@Model.Filter.Bedrooms</text>}},
            min: 0,
            max: 6,
            step: 1,
            afterChange: function () { $("#BedRooms").val(this.options.value); }
             });*@


    });
    // disabling dates
    //  var nowTemp = new Date();
    //   var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);


        @*
                                    var checkin = $('#start').datepicker({
                                        dateFormat: "dd/mm/yy",
                                        onRender: function (date) {
                                            return date.valueOf() < now.valueOf() ? 'disabled' : '';
                                        }
                                    }).on('changeDate', function (ev) {
                                        if (ev.date.valueOf() > checkout.date.valueOf()) {
                                            var newDate = new Date(ev.date)
                                            newDate.setDate(newDate.getDate() + 1);
                                            checkout.setValue(newDate);
                                        }
                                        checkin.hide();
                                        $('#end')[0].focus();
                                    }).data('datepicker');
                                    var checkout = $('#end').datepicker({
                                        format: "dd/mm/yyyy",
                                        onRender: function (date) {
                                            return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
                                        }
                                    }).on('changeDate', function (ev) {
                                        checkout.hide();
                                    }).data('datepicker');
                                *@

    $(function(){
        $(".bkpeople").change(function(){

            var ids = $(this).attr("id");
            var aid = getId(ids);
            calcBkTotal(aid);
        });
        $(".bkacc").change(function(){
            var ids = $(this).attr("id");
            var aid = getId(ids);
            var elem = "#" + aid + "_";
            var rooms = $(elem + "noaccomm").val();
            if(rooms < 1) rooms =1;
            var gmax = $(elem+"maxgt").val();
            var gs = "";
            var cur = 0;
            mx = rooms* gmax;
            cur = $(elem+"adults").val();
            for(i=1;i<=mx;i++)
            {
                gs = gs + "<option value='" + i +"' ";
                if(i==0) gs= gs + " selected ";
                gs = gs + ">" + i +"</option>";
            }
            $(elem+"adults").html(gs);
            if(cur > mx){
                cur = $("#Adults").val();
            }
            $(elem+"adults").val(cur);
            gs="";
            mx = rooms* gmax;
            cur = $(elem+"kids").val();
            for(i=0;i<=mx;i++)
            {
                gs = gs + "<option value='" + i +"' ";
                if(i==0) gs= gs + " selected ";
                gs = gs + ">" + i +"</option>";
            }
            $(elem+"kids").html(gs);
            if(cur > mx){
                cur = $("#Children").val();
            }
            $(elem+"kids").val(cur);
            calcBkTotal(aid);
        });

        $(".bkacc").change();
        $(".backtosearch").click(function(){gotoSearch();});
            @*@if (firstacc>0){
        <text>
            $("#@(firstacc)_noaccomm").val(1);
            $(".bkacc").change();
            </text>
        }*@

    });
    function calcBkTotal(aid)
    {

        var elem = "#" + aid;

        var rooms = $(elem + "_noaccomm").val();
        if(rooms < 1) rooms =1;

        var rt = $(elem + "_rate").val();
        var grt = $(elem + "_grate").val();
        if(rt < 0) rt=0;
        if(grt < 0) grt = 0;
        var gmax = $(elem+"_maxgt").val();
        var pv = $(elem+"_adults").val();
        var px = $(elem+"_maxad").val();
        var guests =0;
        //  alert('adult pv px ' + pv + ' ' + px);
        px = px * rooms;
        if(pv > px) guests = guests + (pv-px);
        pv = $(elem+"_kids").val();
        px = $(elem+"_maxch").val();
        px = px * rooms;
        if(pv > px) guests = guests + (pv-px);
        //  alert('child pv px ' + pv + ' ' + px);
        // = $(elem + "_guests").val();
        $(elem + "_guests").val(guests);

        var total = (guests * grt) + (rooms * rt);
        $(elem + "_showr").html(htmlCurr(total));
        $(elem+"_total").val(total);
        var gtotal =0;
        $(".bkacc").each(function(){
            var id = getId($(this).attr("id"));
            if(parseInt($(this).val()) > 0)
            {
                gtotal = parseFloat(gtotal) + parseFloat($("#"+id+"_total").val());
            }
        });
        $("#BookingTotal").html(htmlCurr(gtotal));
        AddData(aid);
    }

    function htmlCurr(val)
    {
            @*  //var fv = parseFloat(val);
                                    //    var iv = parseInt(val);
                                    //    var sv = " " + fv;
                                    //    var idx = sv.indexOf(".");
                                    //    var len = sv.length;
                                    //    if(idx < 0)
                                    //        return sv ;

                                    //    if(len>= (idx + 3))
                                    //        sv = sv.substr(idx+1, 2);
                                    //    else{
                                    //        if(len >= (idx+2))
                                    //            sv = "" + sv.substr(idx+1, 1) + "0";
                                    //    }
                                    //    return "" + iv + "<small>" + sv + "</small>";       *@
        return Math.round(val) + "";
    }
    function getId(idname)
    {
        var idx = idname.indexOf("_");
        if(idx < 0) return "";
        return idname.substr(0,idx);
    }
    function AddData(aid)
    {
        var bd = $("#BookingData").val();
        var elem = "#" + aid + "_";
        if(bd != "")
        {
            var dt = bd.split("#");
            if(dt.length > 0)
            {
                var len = dt.length;
                var bt;
                var found = false;
                bd="";
                for(i=0;i<len;i++)
                {
                    bt = dt[i].split(",");
                    if(bt.length==5)
                    {
                        if(bt[0] == aid)
                        {
                            bd = bd + "#" + makeData(aid);
                            found=true;
                        }else
                        {
                            bd = bd +"#" + dt[i];
                        }
                    }
                }
                if(!found)
                {
                    bd = bd + "#" + makeData(aid);
                }
            }
        }
        else
        { bd = makeData(aid); }
       // alert(bd);
        $("#BookingData").val(bd);
    }
    function makeData(aid)
    {
        var elem = "#" + aid + "_";
        var guests = 0;
        var ad =$(elem +"adults").val();
        var ch = $(elem +"kids").val();
        var apx = $(elem +"maxad").val();
        var cpx = $(elem +"maxch").val();
        var rooms = $(elem + "noaccomm").val();
        apx = apx * rooms;
        cpx = cpx * rooms;
        if(ad > apx ) {guests = guests + (ad-apx); ad = apx;}
        if(ch > cpx ) {guests = guests + (ch-cpx); ch = cpx;}

        return ""+ aid + "," +  $(elem +"noaccomm").val() +","+ ad +","+ ch +","+ guests;
    }
    function gotoSearch()
    {
       // debugger;
        if ($("#Destination").val() == "")
        {
            $("#Destination").val('@ViewBag.Destination');
        }
        var EmptyDatePart = "0001";
        var valueDate = $("#CheckIn").val();

        if (valueDate.indexOf(EmptyDatePart) != -1)
        {
            $("#CheckIn").val('@ViewBag.CheckIn');
        }
        valueDate = $("#CheckOut").val() ;
        if (valueDate.indexOf(EmptyDatePart) != -1)
        {
            $("#CheckOut").val('@ViewBag.CheckOut');
        }
        if ($("#Adults").val() == "")
        {
            $("#Adults").val('@ViewBag.Adults');
        }
        if ($("#Children").val() == "")
        {
            $("#Children").val('@ViewBag.Children');
        }
        if ($("#Bedrooms").val() == "")
        {
            $("#Bedrooms").val('@ViewBag.Bedrooms');
        }
        if ($("#StayType").val() == "")
        {
            $("#StayType").val('@ViewBag.StayType');
        }

        var start = $("#start").val();
        var end = $("#end").val();

        $("#HiddenCheckIn").val($("#start").val());
        $("#HiddenCheckOut").val($("#end").val());


        //var sDateFormatted = sDate.getFullYear() + "-" + ("0" + (sDate.getMonth() + 1)).slice(-2) + "-" + ("0" + sDate.getDate()).slice(-2);
        //var eDateFormatted = eDate.getFullYear() + "-" + ("0" + (eDate.getMonth() + 1)).slice(-2) + "-" + ("0" + eDate.getDate()).slice(-2);


        var url = "/Search/Index" + "?Destination=" + $("#Destination").val() + "&CheckIn=" + $("#HiddenCheckIn").val() + "&CheckOut=" + $("#HiddenCheckOut").val() + "&Adults=" + $("#Adults").val() + "&Children=" + $("#Children").val() + "&BedRooms=" + $("#Bedrooms").val() + "&StayType=" + $("#StayType").val();
//


   //     var url = "/Search/Index" + "?Destination=" + $("#Destination").val() + "&CheckIn=" + $("#CheckIn").val() + "&CheckOut=" + $("#CheckOut").val() + "&Adults=" + $("#Adults").val() + "&Children=" + $("#Children").val() + "&BedRooms=" + $("#Bedrooms").val() + "&StayType=" + $("#StayType").val();
        window.location.href = url;
            @*frm = document.getElementById('bsearchform');
            //frm = $('#bsearchform');
            frm.action = '@Url.Action("Index","Search")';
            frm.submit();*@
    }
        function reviseDates()
        {


            var start=  $("#start").val();
            var end= $("#end").val();

            $("#HiddenCheckIn").val($("#start").val());
            $("#HiddenCheckOut").val($("#end").val());
            var bConfirmDates = true;
            var url = "/property/property?propertyid=" + @PropertyId + "&adults=" + $("#Adults").val() + "&Destination=" + $("#Destination").val() + "&CheckIn=" + $("#HiddenCheckIn").val() + "&CheckOut=" + $("#HiddenCheckOut").val() + "&Adults=" + $("#Adults").val() + "&Children=" + $("#Children").val() + "&BedRooms=" + $("#Bedrooms").val() + "&StayType=" + $("#StayType").val();
 //           alert(url);
        //    var url = "/Property/AmadeusPropertyDetailsConfirm?Id=@PropertyId" + "&start=" + start + "&end=" + end +"&ConfirmDates="+bConfirmDates+"";

       //     var url = "/Property/AmadeusPropertyDetails?Id=@PropertyId"+"&start="+start+"&end="+end;
            window.location.href = url;

            @*frm = document.getElementById('bsearchform');
            //frm = $('#bsearchform');
            frm.action = '@Url.Action("Property","Property")';
            frm.submit();*@
        }
    function bookAccommodation(ids)
    {
        debugger;
        SelectAccommodation(ids);

        var BookingData = $("#BookingData").val();
     //   alert(BookingData);
        //if ($("#BookingData").val() == "");
        //{
        //    $("#alertfrombookcheck").html('You need to make your accomodation selections  to proceed');
        //    $("#Bookingavailablecheckalert").modal('show');
        //    return false;
        //}
        if (($("#BookingTotal").html() == "0") || (BookingData==""))
        {
            $("#alertfrombookcheck").html('You need to make your accomodation selections  to proceed');
            $("#Bookingavailablecheckalert").modal('show');
            return false;
        }
        else
        {
            document.getElementById('loading').style.display='block';

            var url = "@Url.Action("CheckAccommodationAvailable", "Property")";

            $.get(url,{PropertyId: @PropertyId, BookingData: $("#BookingData").val(),CheckIn :$("#BookCheckIn").val(),CheckOut : $("#BookCheckOut").val()}, function (data) {

                document.getElementById('loading').style.display='none';
                if(data == "true")
                {
                    $.cookie("BookingData",$("#BookingData").val(), { path: '/' });
                    $.cookie("BookCheckIn",$("#BookCheckIn").val(), { path: '/' });
                    $.cookie("BookCheckOut",$("#BookCheckOut").val(), { path: '/' });

                    $( "#BookAccommodation" ).submit();
                }
                else
                {
                    $("#alertfrombookcheck").html(data);
                    $("#Bookingavailablecheckalert").modal('show');
                }
            });
        }
    }

    function pad(num, size) {
        var s = num + "";
        while (s.length < size) s = "0" + s;
        return s;
    }
    function checkDate(field) {
        var allowBlank = true; var minYear = 2014; var maxYear = (new Date()).getFullYear()+1;
        // regular expression to match required date format
        re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
        if (field != '') {
            if (regs = field.match(re)) {
                if (regs[1] < 1 || regs[1] > 31)
                { return false; }
                else if (regs[2] < 1 || regs[2] > 12)
                { return false; }
                else if (regs[3] < minYear || regs[3] > maxYear)
                { return false; }
            } else { return false; }
        } else { return false; }
        return true;
    }
    function daydiff(first, second) {
        return (second - first) / (1000 * 60 * 60 * 24);
    }
    function validDates()
    {
        return valdInOutDates();
    }
    function valdInOutDates() {
        var v = $("#start").val().trim();
        if (checkDate(v)) {
            re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;
            if (regs = v.match(re)) {
                var cs = new Date(regs[3], regs[2], regs[1]);
                var xo = $("#end").val();
                //                    $("#CheckOut").datepicker("option", "minDate", mind);

                if (checkDate(xo)) {
                    if (regss = xo.match(re)) {
                        var co = new Date(regss[3], regss[2], regss[1]);
                        if (co <= cs) {
                            alert('Please enter a checkout date which falls after checkin date');
                            $("#end").focus();
                            return false;
                        }
                    }
                    else {
                        alert('Invalid Check Out date');
                        $("#end").focus();
                        return false;
                    }
                }
                else {
                    alert('Invalid Check Out date');
                    $("#end").focus();
                    return false;
                }
            }
            else {
                alert('Invalid Check In date');
                $("#start").focus();
                return false;
            }
        } else {
            alert('Invalid Check In date');
            $("#start").focus();
            return false;
        }
        return true;
    }
    $(function () {
        $('[data-toggle="tooltip"]').tooltip({ 'placement': 'top' });
    });

        @*$(function(){
                                        @*var url = '@Url.Action("PolicyText", "Cancellation")?pId=@(Model.PropertyId)';
                                        $.get(url, function (data) {
                                            $("#policytooltip").attr("title",data);
                                        });
                                    });*@
    $('#policytooltip').popover({ trigger: "hover" });
    $(".maxpinfo").popover({trigger:"hover"});
    $("#revisedatebuttton").click(function(){
        $("#confirmdatebutton").show();
        $("#revisedatebuttton").hide();
        $('#start').removeAttr("readonly");
        $('#end').removeAttr("readonly");
        $("#start").removeClass("greybgc");
        $("#end").removeClass("greybgc");
        setCalendar();
        $("#start").focus(); //datepicker('show');
    })
    $("#confirmdatebutton").hide();
    $("#start").addClass("greybgc");
        $("#end").addClass("greybgc");


        $(document).ready(function () {
            $("#dvContentMore").click(function () {
                //Do stuff when clicked

                $("#dvPartialContent").hide();
                $("#dvFullContent").show();
            });
            $("#dvContentLess").click(function () {

                $("#dvFullContent").hide();
                $("#dvPartialContent").show();
                //Do stuff when clicked
            });
        });
</script>
<script src="~/Scripts/lightgallery.js"></script>
<script type="text/javascript">
        $(document).ready(function () {
            $('.lightgallery').lightGallery();
        });
</script>
<script>
        var fixmeTop = $('.fixme').offset().top;       // get initial position of the element
        var heightDiv = $('.table-in').height();
        $(window).scroll(function () {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            console.log(currentScroll, fixmeTop, heightDiv, fixmeTop + heightDiv);
            if (currentScroll <= fixmeTop || currentScroll > fixmeTop + heightDiv - 100) {
                console.log("in");
                // apply position: fixed if you

                $('.time-in').css({                      // if you scroll above it
                    position: 'static'
                });
                $('.main-1').css({                      // scroll to that element or below it
                    width: 'auto',
                });
                $('.main-2').css({                      // scroll to that element or below it
                    width: 'auto',
                });
                $('.main-3').css({                      // scroll to that element or below it
                    width: 'auto',
                });
                $('.main-4').css({                      // scroll to that element or below it
                    width: 'auto',
                });


            }
            //        else if(currentScroll >= theHeight){
            //            console.log(currentScroll);
            //        }
            else {
                console.log("out");                    // apply position: static


                $('.time-in').css({                      // scroll to that element or below it
                    position: 'fixed',
                    top: '0',

                });
                $('.main-1').css({                      // scroll to that element or below it
                    width: '424px',
                });
                $('.main-2').css({                      // scroll to that element or below it
                    width: '59px',
                });
                $('.main-3').css({                      // scroll to that element or below it
                    width: '123px',
                });
                $('.main-4').css({                      // scroll to that element or below it
                    width: '123px',
                });
            }

        });
</script>
 <style>
     .Amenities-ul {
         flex-wrap: wrap;
         display: flex;
     }

         .Amenities-ul li {
             width: 33.333333333%;
         }
 </style>

 }
  catch (Exception ex)
  {
 StayBazar.Common.LogHandler.HandleError(ex);
 Response.Redirect("~/Search");
 }
